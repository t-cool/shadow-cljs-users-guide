<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="author" content="Thomas Heller and Tony Kay">
<title>Shadow CLJS User&#8217;s Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Shadow CLJS User&#8217;s Guide</h1>
<div class="details">
<span id="author" class="author">Thomas Heller and Tony Kay</span><br>
<span id="revnumber">version 1.0,</span>
<span id="revdate">Jan 10, 2018</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_はじめに">1. はじめに</a>
<ul class="sectlevel2">
<li><a href="#_高レベルな概要">1.1. 高レベルな概要</a></li>
<li><a href="#_基本的なワークフロー">1.2. 基本的なワークフロー</a>
<ul class="sectlevel3">
<li><a href="#_development_モード">1.2.1. development モード</a></li>
<li><a href="#_release_モード">1.2.2. release モード</a></li>
</ul>
</li>
<li><a href="#_重要な概念">1.3. 重要な概念</a>
<ul class="sectlevel3">
<li><a href="#_classpath">1.3.1. Classpath</a></li>
<li><a href="#_server_モード">1.3.2. server モード</a></li>
<li><a href="#_repl">1.3.3. REPL</a></li>
</ul>
</li>
<li><a href="#_本書について">1.4. 本書について</a>
<ul class="sectlevel3">
<li><a href="#_進行中">1.4.1. 進行中</a></li>
<li><a href="#_貢献">1.4.2. 貢献</a></li>
<li><a href="#_使用した規約">1.4.3. 使用した規約</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_インストール">2. インストール</a>
<ul class="sectlevel2">
<li><a href="#_npm_によるスタンドアロン化">2.1. npm によるスタンドアロン化</a></li>
<li><a href="#_ライブラリ">2.2. ライブラリ</a></li>
</ul>
</li>
<li><a href="#_利用法">3. 利用法</a>
<ul class="sectlevel2">
<li><a href="#_コマンドライン">3.1. コマンドライン</a>
<ul class="sectlevel3">
<li><a href="#server-mode">3.1.1. サーバ・モード</a></li>
</ul>
</li>
<li><a href="#_ビルドツールの統合">3.2. ビルドツールの統合</a>
<ul class="sectlevel3">
<li><a href="#Leiningen">3.2.1. Leiningen</a></li>
<li><a href="#deps-edn">3.2.2. tools.deps / deps.edn</a></li>
<li><a href="#_boot">3.2.3. Boot</a></li>
</ul>
</li>
<li><a href="#clj-run">3.3. Clojureコードの実行</a>
<ul class="sectlevel3">
<li><a href="#_clj_run_による_watch_の呼び出し">3.3.1. clj-run による watch の呼び出し</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_repl_2">4. REPL</a>
<ul class="sectlevel2">
<li><a href="#_clojurescript_repl">4.1. ClojureScript REPL</a>
<ul class="sectlevel3">
<li><a href="#node-repl">4.1.1. Node REPL</a></li>
<li><a href="#browser-repl">4.1.2. Browser REPL</a></li>
<li><a href="#build-repl">4.1.3. ビルドに特化した REPL</a></li>
</ul>
</li>
<li><a href="#_clojure_repl">4.2. Clojure REPL</a>
<ul class="sectlevel3">
<li><a href="#embedded">4.2.1. 組み込み</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#config">5. 設定</a>
<ul class="sectlevel2">
<li><a href="#source-paths">5.1. ソースのパス</a></li>
<li><a href="#_依存関係">5.2. 依存関係</a>
<ul class="sectlevel3">
<li><a href="#_clojure_script">5.2.1. Clojure(Script)</a></li>
<li><a href="#npm-install">5.2.2. JavaScript</a></li>
</ul>
</li>
<li><a href="#user-config">5.3. ユーザの設定</a></li>
<li><a href="#_サーバのオプション">5.4. サーバのオプション</a>
<ul class="sectlevel3">
<li><a href="#nREPL">5.4.1. nREPL</a></li>
<li><a href="#socket-repl">5.4.2. Socket REPL</a></li>
<li><a href="#_ssl">5.4.3. SSL</a></li>
<li><a href="#http">5.4.4. Primary HTTP(S)</a></li>
<li><a href="#dev-http">5.4.5. 開発の HTTP(S)</a></li>
</ul>
</li>
<li><a href="#jvm-opts">5.5. JVM の設定</a></li>
</ul>
</li>
<li><a href="#_ビルドの設定">6. ビルドの設定</a>
<ul class="sectlevel2">
<li><a href="#_ビルドターゲット">6.1. ビルドターゲット</a></li>
<li><a href="#devtools">6.2. 開発オプション</a>
<ul class="sectlevel3">
<li><a href="#_repl_3">6.2.1. REPL</a></li>
<li><a href="#_プリロード">6.2.2. プリロード</a></li>
<li><a href="#_ホットコードリロード">6.2.3. ホットコードリロード</a></li>
<li><a href="#_ライフサイクルフック">6.2.4. ライフサイクルフック</a></li>
</ul>
</li>
<li><a href="#build-hooks">6.3. ビルドフック</a>
<ul class="sectlevel3">
<li><a href="#compile-stages">6.3.1. コンパイル・ステージ</a></li>
</ul>
</li>
<li><a href="#_コンパイラ_キャッシュ">6.4. コンパイラ・キャッシュ</a></li>
<li><a href="#closure-defines">6.5. クロージャの定義</a></li>
<li><a href="#compiler-options">6.6. コンパイラのオプション</a>
<ul class="sectlevel3">
<li><a href="#warnigs-as-errors">6.6.1. エラーとしてのワーニング</a></li>
</ul>
</li>
<li><a href="#_出力言語オプション">6.7. 出力言語オプション</a></li>
<li><a href="#_conditional_reading">6.8. Conditional Reading</a></li>
<li><a href="#config-merge">6.9. CLIからのオーバーライド</a></li>
<li><a href="#shadow-env">6.10. 環境変数の使用</a></li>
<li><a href="#build-target-defaults">6.11. ビルドとターゲットのデフォルト</a></li>
</ul>
</li>
<li><a href="#target-browser">7. ブラウザを対象とする</a>
<ul class="sectlevel2">
<li><a href="#_出力設定">7.1. 出力設定</a></li>
<li><a href="#_モジュール">7.2. モジュール</a></li>
<li><a href="#CodeSplitting">7.3. コード・スプリッティング</a>
<ul class="sectlevel3">
<li><a href="#_動的にコードを読み込む">7.3.1. 動的にコードを読み込む</a></li>
</ul>
</li>
<li><a href="#output-wrapper">7.4. アウトプット・ラッパー</a></li>
<li><a href="#_ウェブワーカー">7.5. ウェブワーカー</a></li>
<li><a href="#_キャッシュ可能な出力">7.6. キャッシュ可能な出力</a>
<ul class="sectlevel3">
<li><a href="#release-version">7.6.1. リリースバージョン</a></li>
<li><a href="#NameHashing">7.6.2. フィンガープリント・ハッシュを使ったファイル名</a></li>
</ul>
</li>
<li><a href="#BrowserManifest">7.7. 出力マニフェスト</a></li>
<li><a href="#_開発サポート">7.8. 開発サポート</a>
<ul class="sectlevel3">
<li><a href="#hud">7.8.1. ヘッドアップディスプレイ（HUD）</a></li>
<li><a href="#_css_リローディング">7.8.2. CSS リローディング</a></li>
<li><a href="#proxy-support">7.8.3. プロキシサポート</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#target-react-native">8. React Nativeをターゲットにする</a>
<ul class="sectlevel2">
<li><a href="#_react_native">8.1. React Native</a></li>
<li><a href="#_expo">8.2. Expo</a></li>
</ul>
</li>
<li><a href="#target-node">9. node.jsを対象とする</a>
<ul class="sectlevel2">
<li><a href="#target-node-script">9.1. node.js のスクリプト</a>
<ul class="sectlevel3">
<li><a href="#_ビルドオプション">9.1.1. ビルドオプション</a></li>
<li><a href="#NodeHotCodeReload">9.1.2. ホットコードリロード</a></li>
</ul>
</li>
<li><a href="#target-node-library">9.2. node.js ライブラリ</a>
<ul class="sectlevel3">
<li><a href="#_単一で静的な_デフォルト_エクスポート">9.2.1. 単一で静的な "デフォルト" エクスポート</a></li>
<li><a href="#_複数の静的な名前付きエクスポート">9.2.2. 複数の静的な名前付きエクスポート</a></li>
<li><a href="#_dynamic_exports">9.2.3. "Dynamic" exports</a></li>
<li><a href="#_完全な例">9.2.4. 完全な例</a></li>
</ul>
</li>
<li><a href="#_npm_パッケージの作成">9.3. npm パッケージの作成</a></li>
</ul>
</li>
<li><a href="#target-npm-module">10. JSエコシステムへの組み込み&#8201;&#8212;&#8201;<code>:npm-module</code> ターゲット</a></li>
<li><a href="#target-npm-module">11. JSエコシステムへの組み込み - :npm-module ターゲット</a>
<ul class="sectlevel2">
<li><a href="#_working_with_optimizations">11.1. Working with Optimizations</a></li>
</ul>
</li>
<li><a href="#_テスト">12. テスト</a>
<ul class="sectlevel2">
<li><a href="#_node_js_におけるテスト_a_id_target_node_test_a">12.1. node.js におけるテスト　<a id="target-node-test"></a></a></li>
<li><a href="#target-browser-test">12.2. ブラウザにおけるテスト</a>
<ul class="sectlevel3">
<li><a href="#_test_dir_に生成された出力">12.2.1. :test-dir に生成された出力</a></li>
</ul>
</li>
<li><a href="#target-karma">12.3. 継続的インテグレーションのためにテストをKarmaにターゲットする</a>
<ul class="sectlevel3">
<li><a href="#_karmaのインストール">12.3.1. Karmaのインストール</a></li>
<li><a href="#_build">12.3.2. Build</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#js-deps">13. JavaScript との統合</a>
<ul class="sectlevel2">
<li><a href="#npm">13.1. NPM</a>
<ul class="sectlevel3">
<li><a href="#_npmパッケージの使用">13.1.1. npmパッケージの使用</a></li>
<li><a href="#js-provider">13.1.2. パッケージプロバイダ</a></li>
<li><a href="#js-entry-keys">13.1.3. CommonJS vs ESM</a></li>
<li><a href="#js-resolve">13.1.4. パッケージを解決する</a></li>
<li><a href="#alt-node-modules">13.1.5. 代替モジュールのディレクトリ</a></li>
</ul>
</li>
<li><a href="#classpath-js">13.2. .jsファイルへの対応</a>
<ul class="sectlevel3">
<li><a href="#_jsをrequrieする">13.2.1. JSをrequrieする</a></li>
<li><a href="#_言語サポート">13.2.2. 言語サポート</a></li>
<li><a href="#_javascriptの方言">13.2.3. JavaScriptの方言</a></li>
<li><a href="#_jsからcljsへのアクセス">13.2.4. JSからCLJSへのアクセス</a></li>
</ul>
</li>
<li><a href="#cljsjs">13.3. cljsjs.* の移行について</a>
<ul class="sectlevel3">
<li><a href="#_cljsjsを使ってみませんか">13.3.1. CLJSJSを使ってみませんか?</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#release">14. プロダクションコードの生成&#8201;&#8212;&#8201;全ターゲット</a>
<ul class="sectlevel2">
<li><a href="#_リリースの構成">14.1. リリースの構成</a>
<ul class="sectlevel3">
<li><a href="#Optimization">14.1.1. 最適化</a></li>
<li><a href="#_release_に特異_vs_開発環境">14.1.2. release に特異 vs 開発環境</a></li>
</ul>
</li>
<li><a href="#externs">14.2. エクスターン</a>
<ul class="sectlevel3">
<li><a href="#infer-externs">14.2.1. エクスターンズの推論</a></li>
<li><a href="#_マニュアルのエクスターン">14.2.2. マニュアルのエクスターン</a></li>
<li><a href="#_簡易なエクスターン">14.2.3. 簡易なエクスターン</a></li>
</ul>
</li>
<li><a href="#_コード_ストリッピング">14.3. コード・ストリッピング</a></li>
<li><a href="#build-report">14.4. ビルドレポート</a></li>
</ul>
</li>
<li><a href="#_エディタの統合">15. エディタの統合</a>
<ul class="sectlevel2">
<li><a href="#_cursive">15.1. Cursive</a></li>
<li><a href="#cider">15.2. Emacs / CIDER</a>
<ul class="sectlevel3">
<li><a href="#_clojurescript_replの起動">15.2.1. ClojureScript REPLの起動</a></li>
<li><a href="#_dir_localによるスタートアップの簡素化">15.2.2. dir-localによるスタートアップの簡素化</a></li>
</ul>
</li>
<li><a href="#_proto_repl_atom">15.3. Proto REPL (Atom)</a></li>
<li><a href="#_chlorine_atom">15.4. Chlorine (Atom)</a></li>
<li><a href="#_calva_vs_code">15.5. Calva (VS Code)</a>
<ul class="sectlevel3">
<li><a href="#_依存関係_2">15.5.1. 依存関係</a></li>
<li><a href="#_calvaとreplの接続">15.5.2. CalvaとREPLの接続</a></li>
<li><a href="#_特徴">15.5.3. 特徴</a></li>
</ul>
</li>
<li><a href="#_fireplace_vim_vim_neovim">15.6. Fireplace.vim (Vim/Neovim)</a>
<ul class="sectlevel3">
<li><a href="#_依存関係_3">15.6.1. 依存関係</a></li>
<li><a href="#_アプリの準備">15.6.2. アプリの準備</a></li>
<li><a href="#_fireplace_vimとreplサーバーの接続">15.6.3. Fireplace.vimとREPLサーバーの接続</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_トラブルシューティング">16. トラブルシューティング</a>
<ul class="sectlevel2">
<li><a href="#failed-to-load">16.1. 起動時のエラー</a>
<ul class="sectlevel3">
<li><a href="#_deps_edn_tools_deps">16.1.1. deps.edn / tools.deps</a></li>
<li><a href="#_project_clj_leiningen">16.1.2. project.clj / Leiningen</a></li>
</ul>
</li>
<li><a href="#repl-troubleshooting">16.2. REPL</a>
<ul class="sectlevel3">
<li><a href="#cljs-repl-anatomy">16.2.1. CLJS REPLの分析</a></li>
<li><a href="#_javascript_のランタイム">16.2.2. JavaScript のランタイム</a></li>
<li><a href="#missing-js-runtime">16.2.3. Missing JS runtime</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#publish">17. ライブラリの publish</a>
<ul class="sectlevel2">
<li><a href="#publish-lein">17.1. Leiningen</a>
<ul class="sectlevel3">
<li><a href="#_jar署名の無効化">17.1.1. JAR署名の無効化</a></li>
<li><a href="#_jarをクリーンに保つ">17.1.2. JARをクリーンに保つ</a></li>
</ul>
</li>
<li><a href="#publish-deps-cljs">17.2. JSの依存関係を宣言する</a></li>
</ul>
</li>
<li><a href="#_上手くいかない場合はどうすればいいか">18. 上手くいかない場合はどうすればいいか</a></li>
<li><a href="#_hacking">19. Hacking</a>
<ul class="sectlevel2">
<li><a href="#_ライブラリーのパッチ適用">19.1. ライブラリーのパッチ適用</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_はじめに"><a class="anchor" href="#_はじめに"></a><a class="link" href="#_はじめに">1. はじめに</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>shadow-cljsは、シンプルさと使いやすさに重点を置いて、ClojureScriptプロジェクトをコンパイルするために必要なすべてを提供します。提供されているビルドターゲットは、手動による設定のほとんどを抽象化し、ビルドに必要なものだけを設定することができます。各ターゲットはそれぞれの環境に最適なデフォルトを提供し、開発時やリリースビルド時に最適なエクスペリエンスを得ることができます。</p>
</div>
<div class="sect2">
<h3 id="_高レベルな概要"><a class="anchor" href="#_高レベルな概要"></a><a class="link" href="#_高レベルな概要">1.1. 高レベルな概要</a></h3>
<div class="paragraph">
<p>shadow-cljs は2つの部分から構成されています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://clojars.org/thheller/shadow-cljs">shadow-cljs</a>
まずは、実際の仕事をすべて行うClojureライブラリです。</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://www.npmjs.com/package/shadow-cljs">shadow-cljs</a>
もう一方は、ビルド機能の大半をコマンドラインから直接実行するための便利なインターフェースを提供するnpmパッケージです。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>必要であれば、Clojureライブラリであるshadow-cljsを、他のClojure/JVMビルドツール（例えば、https://leiningen.org/[leiningen]や、https://clojure.org/guides/deps_and_cli[Clojure CLI]ツール）に簡単に統合することができます。</p>
</div>
<div class="paragraph">
<p>CLJSの開発に合わせて、より最適化された開発環境を提供するので、npmパッケージを使用することをお勧めします。</p>
</div>
</div>
<div class="sect2">
<h3 id="_基本的なワークフロー"><a class="anchor" href="#_基本的なワークフロー"></a><a class="link" href="#_基本的なワークフロー">1.2. 基本的なワークフロー</a></h3>
<div class="paragraph">
<p>shadow-cljs を使用する際には、設定ファイル shadow-cljs.edn で 1 つ以上のビルドを定義します。それぞれのビルドは、ターゲットとなる環境（例えば、ブラウザ、node.jsアプリケーション、Chrome拡張機能等）に最適化された構成プリセットを表す :target プロパティをもちます。</p>
</div>
<div class="paragraph">
<p>各ビルドは、コンパイルのトリガーとなったコマンドに応じて、開発用またはリリース用の出力を生成します。標準的なビルドコマンドは、compile、watch、release です。</p>
</div>
<div class="sect3">
<h4 id="_development_モード"><a class="anchor" href="#_development_モード"></a><a class="link" href="#_development_モード">1.2.1. development モード</a></h4>
<div class="paragraph">
<p>開発ビルドを一度だけコンパイルすることも、watch プロセスを実行してソースファイルを監視して自動的に再コンパイルすることもできます（必要に応じてコードをライブロードすることもできます）。</p>
</div>
<div class="paragraph">
<p>すべての開発ビルドは、高速なフィードバックサイクルや、実行中のコードと直接やりとりできるREPLなどの機能により、開発者の体験を最適化します。</p>
</div>
<div class="paragraph">
<p>開発用のビルドは、非常に大きなサイズになる可能性があり、:targetに応じてコンパイルされたマシンでしか動作しない可能性があるため、決して一般に配布してはいけません。</p>
</div>
</div>
<div class="sect3">
<h4 id="_release_モード"><a class="anchor" href="#_release_モード"></a><a class="link" href="#_release_モード">1.2.2. release モード</a></h4>
<div class="paragraph">
<p>リリース (release) ビルドを作成すると、開発モード関連のコードがすべて取り除かれ、最後にClosure Compilerにコードを通します。これにより、JavaScript用の最適化コンパイラが、コードの全体的なサイズを大幅に削減します。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_重要な概念"><a class="anchor" href="#_重要な概念"></a><a class="link" href="#_重要な概念">1.3. 重要な概念</a></h3>
<div class="paragraph">
<p>shadow-cljsを使用する際には、いくつかの重要な概念を理解しておく必要があります。これらの概念は、すべてがどのように組み合わされるのか、また、このツールがあなたのコードとどのように連動するのかを理解するために不可欠です。</p>
</div>
<div class="sect3">
<h4 id="_classpath"><a class="anchor" href="#_classpath"></a><a class="link" href="#_classpath">1.3.1. Classpath</a></h4>
<div class="paragraph">
<p>shadow-cljsは、ファイルを扱う際に、Java Virtual Machine (JVM) とそのclasspathを使用します。これは、多くのclasspathのエントリからなる仮想ファイルシステムです。各エントリは次のいずれかです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>設定の:source-pathsエントリで管理される、ローカルファイルシステムのディレクトリです。</p>
</li>
<li>
<p>あるいは、Clojure(Script)やJVMのライブラリを表す.jar`ファイルです。これらは、多くのファイルを含む圧縮アーカイブです(基本的には.zipファイルです)。これらは:dependenciesによって追加されます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Clojure(Script)では、すべてが名前空間化されていて、それぞれの名前がファイルに解決することが期待されています。(ns demo.app)という名前空間があれば、コンパイラはクラスパス上にdemo/app.cljs(または`.cljc`)があることを期待します。クラスパスは、それが見つかるまで順番に検索されます。例えば、<code>:source-paths ["src/main" "src/test"]</code> を設定したとすると、コンパイラはまず <code>src/main/demo/app.cljs</code> を探し、次に <code>src/test/demo/app.cljs</code> を探します。どのソースパスにもファイルが見つからない場合、JVMはクラスパス上の.jarファイルを探し始めます。そして、いずれかのライブラリのルートにdemo/app.cljsが見つかると、そのファイルが使用されます。</p>
</div>
<div class="paragraph">
<p>重要：あるファイル名がクラスパス上に複数回存在する場合、最初のものだけが使用されます。JVMとClojure(Script)上のすべてのものは、このような衝突を避けるために名前空間が設けられています。各パッケージが一意の名前を持たなければならないnpmと非常によく似ています。</p>
</div>
<div class="paragraph">
<p>そのため、名前の選択には細心の注意を払い、すべてのものに適切な名前空間をつけることをお勧めします。(ns component.foo)よりも(ns your-company.components.foo)を常に使うことは反復的に見えるかもしれませんが、後で多くの頭痛の種をなくすことができます。</p>
</div>
<div class="paragraph">
<p>これはnpmとは異なり、パッケージ名自体がパッケージ内部で使用されることはなく、相対パスのみが使用されます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_server_モード"><a class="anchor" href="#_server_モード"></a><a class="link" href="#_server_モード">1.3.2. server モード</a></h4>
<div class="paragraph">
<p>shadow-cljs` はserverモードで起動することができます。これはwatchのような長時間稼働するタスクに必要です。watchは、サーバーインスタンスがまだ起動していなければ、暗黙のうちに起動します。serverは、ビルドが接続するWebsocketのエンドポイントを提供します。また、nREPL、Socket REPL、開発用HTTPサーバーの他のすべてのエンドポイントも同様に提供します。</p>
</div>
<div class="paragraph">
<p>CLI のshadow-cljsを使用する場合、すべてのコマンドは新しいJVMを起動する代わりに、実行中のサーバインスタンスのJVMを再利用します。起動時間がかなり遅くなることがあるため、動作が大幅に速くなります。</p>
</div>
<div class="paragraph">
<p>しかし、いったんサーバが稼働すれば、:dependenciesに変更があったときに再起動するだけで、あとはすべてREPLで行うことができます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_repl"><a class="anchor" href="#_repl"></a><a class="link" href="#_repl">1.3.3. REPL</a></h4>
<div class="paragraph">
<p>REPLは、すべてのClojure(Script)開発の中心であり、すべてのCLIコマンドはREPLから直接使用することもできます。コマンドラインの方が馴染みがあるように見えても、REPLを使いこなすことには、絶対に価値があります。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_本書について"><a class="anchor" href="#_本書について"></a><a class="link" href="#_本書について">1.4. 本書について</a></h3>
<div class="sect3">
<h4 id="_進行中"><a class="anchor" href="#_進行中"></a><a class="link" href="#_進行中">1.4.1. 進行中</a></h4>
<div class="paragraph">
<p>これは現在進行中の作業です。エラーを発見した場合は、それを修正するためのPR、または問題の詳細を記載したissueを提出してください。</p>
</div>
</div>
<div class="sect3">
<h4 id="_貢献"><a class="anchor" href="#_貢献"></a><a class="link" href="#_貢献">1.4.2. 貢献</a></h4>
<div class="paragraph">
<p>この本のソースは、https://github.com/shadow-cljs/shadow-cljs.github.io[Github] にあります。</p>
</div>
</div>
<div class="sect3">
<h4 id="_使用した規約"><a class="anchor" href="#_使用した規約"></a><a class="link" href="#_使用した規約">1.4.3. 使用した規約</a></h4>
<div class="paragraph">
<p>この本にはたくさんの例題があります。これらの中で使われているほとんどのものは、その文脈から明らかなはずです。
しかし、誤解を防ぐためには、作者の意図を知ることが大切です。</p>
</div>
<div class="paragraph">
<p>コマンドラインの例を示す場合、（# で始まる）BASH のコメントを含めることがあります。
また、通常は、コマンドとその出力を分離するために、標準的なユーザーUNIXのプロンプトである$を含めます。$をその出力から分離することを意味します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># A comment. This command lists files:
$ ls -l
shadow-cljs.edn
project.clj
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>例題の多くは、コンパイラの設定ファイルです。このファイルには、EDNマップが含まれています。必要なオプションについてすでに説明している場合は、わかりやすくするために省略することがあります。この場合、「必要だが、現在の焦点ではない内容」を示すために省略記号を入れるのが普通です。</p>
</div>
<div class="listingblock">
<div class="title">Example 1. 依存関係の指定</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:dependencies</span> [[lib <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>]]}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example 2. ソースパスの追加</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:source-paths</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">src</span><span class="delimiter">&quot;</span></span>]
 <span class="keyword">..</span><span class="keyword">.</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>これにより、対象となる構成の入れ子を理解するのに十分なコンテキストを簡潔に含めることができます。</p>
</div>
<div class="listingblock">
<div class="title">Example 3. ネストのオプション</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span> {<span class="symbol">:build-id</span> {<span class="keyword">..</span><span class="keyword">.</span>
                     <span class="symbol">:output-dir</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">resources/public/js</span><span class="delimiter">&quot;</span></span>}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>コード例も同様に短くすることができます。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_インストール"><a class="anchor" href="#_インストール"></a><a class="link" href="#_インストール">2. インストール</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_npm_によるスタンドアロン化"><a class="anchor" href="#_npm_によるスタンドアロン化"></a><a class="link" href="#_npm_によるスタンドアロン化">2.1. npm によるスタンドアロン化</a></h3>
<div class="paragraph">
<p>以下のことが必要となります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://nodejs.org"><code>node.js</code></a> (v6.0.0+, 最新のバージョンが望ましいです)</p>
</li>
<li>
<p><a href="https://www.npmjs.com"><code>npm</code></a> or <a href="https://www.yarnpkg.com"><code>yarn</code></a></p>
</li>
<li>
<p>任意のJava SDK (バージョン8以上) <a href="http://openjdk.java.net/install/">OpenJDK</a> or <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Oracle</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>プロジェクトのディレクトリには、package.json が必要です。まだない場合は、<code>npm init -y</code> を実行して作成することができます。プロジェクトディレクトリがない場合は、次のコマンドを実行して作成してください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">$ npx create-cljs-project my-project</code></pre>
</div>
</div>
<div class="paragraph">
<p>これで必要な基本ファイルがすべて作成されるので、以下のコマンドは省略できます。</p>
</div>
<div class="paragraph">
<p>すでに <code>package.json</code> があり、<code>shadow-cljs</code> を追加したいだけの場合は、以下を実行します。</p>
</div>
<div class="listingblock">
<div class="title">NPM</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ npm install --save-dev shadow-cljs</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Yarn</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ yarn add --dev shadow-cljs</code></pre>
</div>
</div>
<div class="paragraph">
<p>便宜上、<code>npm install -g shadow-cljs</code> または <code>yarn global add shadow-cljs</code> を実行することができます。これにより、後で <code>shadow-cljs</code> コマンドを直接実行できるようになります。あなたのプロジェクトには常に shadow-cljs のバージョンがインストールされている必要があり、グローバル・インストールはオプションです。</p>
</div>
</div>
<div class="sect2">
<h3 id="_ライブラリ"><a class="anchor" href="#_ライブラリ"></a><a class="link" href="#_ライブラリ">2.2. ライブラリ</a></h3>
<div class="paragraph">
<p>スタンドアロン版は <code>npm</code> 経由で実行することが推奨されますが、<code>shadow-cljs</code> を他の Clojure JVM ツール (例えば lein や boot 等) に組み込むこともできます。</p>
</div>
<div class="paragraph">
<p>このアーティファクトは以下のサイトでご覧いただけます。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_利用法"><a class="anchor" href="#_利用法"></a><a class="link" href="#_利用法">3. 利用法</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>shadow-cljs は様々な方法で使用できますが、一般的なワークフローは同じです。</p>
</div>
<div class="paragraph">
<p>開発中には、ビルドを一度だけ <code>compile</code> するか、ソースファイルの変更を監視して自動的に再コンパイルする <code>watch</code> ワーカーを実行するかのオプションがあります。このワーカーはソースファイルの変更を監視し、自動的に再コンパイルします。<a href="#devtools">enabled</a> の場合、<code>watch</code> はコードをホットリロードし、REPLを提供します。開発中は、迅速なフィードバックサイクルによる開発者の経験に重点を置いています。開発コードは決して一般に出荷してはいけません。</p>
</div>
<div class="paragraph">
<p>本格的に開発する場合には、<a href="#release"><code>release</code></a>というビルドを作成し、本番環境に適した最適化されたビルドを作成します。これには、https://developers.google.com/closure/compiler/[Closure Compiler] が使用され、利用可能な最も最適な出力を作成するために、コードに深刻な <code>:advanced</code> 最適化を適用します。ネイティブJavaScriptとのインターロップを多用している場合には、適切に動作させるためにいくつかの<a href="#externs">tuning</a>が必要になるかもしれませんが、ClojureScript(およびhttps://developers.google.com/closure/library/[Closure Library]のコード)では完璧に動作します。</p>
</div>
<div class="sect2">
<h3 id="_コマンドライン"><a class="anchor" href="#_コマンドライン"></a><a class="link" href="#_コマンドライン">3.1. コマンドライン</a></h3>
<div class="paragraph">
<p>グローバル環境にインストールされている場合は、`shadow-cljs`コマンドを直接使用することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ shadow-cljs help</code></pre>
</div>
</div>
<div class="paragraph">
<p>ローカルにインストールした`npm`のみを使用したい場合は、`npx`や`yarn`を介して起動することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># npm
$ npx shadow-cljs help

# yarn
$ yarn shadow-cljs help

# manually
$ ./node_modules/.bin/shadow-cljs help</code></pre>
</div>
</div>
<div class="paragraph">
<p>このガイドでは、例を短くするためにグローバルインストールを前提としていますが、これは必須ではありません。</p>
</div>
<div class="paragraph">
<p>開発中によく使う shadow-cljs コマンドは以下の通りです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># ビルドを一度コンパイルして終了
$ shadow-cljs compile app

# コンパイルと監視
$ shadow-cljs watch app

# ビルド用のREPLに接続 (watchの実行中に利用可能)$ shadow-cljs cljs-repl app

# スタンドアロンの Node repl への接続
$ shadow-cljs node-repl</code></pre>
</div>
</div>
<div class="paragraph">
<p>次のように、本番使用に最適化されたリリースビルドを実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">$ shadow-cljs release app</code></pre>
</div>
</div>
<div class="paragraph">
<p>`:advanced`のコンパイルが原因で、リリース上の問題に遭遇することがあります。これらのコマンドは、その原因を追跡するのに役立ちます。</p>
</div>
<div class="paragraph">
<p>Release デバッグコマンド</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">$ shadow-cljs check app
$ shadow-cljs release app --debug</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="server-mode"><a class="anchor" href="#server-mode"></a><a class="link" href="#server-mode">3.1.1. サーバ・モード</a></h4>
<div class="paragraph">
<p>shadow-cljs コマンドは起動にかなり時間がかかります。これを改善するために、<code>shadow-cljs</code> は "サーバ・モード" で動作させることができます。これは、専用のプロセスが開始され、他のすべてのコマンドがそれを利用して、新しい JVM/Clojure インスタンスを開始する必要がないため、より速く実行できることを意味します。</p>
</div>
<div class="paragraph">
<p>長時間実行される処理を行うコマンドは、暗黙のうちにサーバーインスタンスを起動しますが（例：<code>watch</code>）、多くの場合、専用のサーバ・プロセスを起動することが望ましいでしょう。専用のサーバ・プロセスを実行することが望ましい場合もあります。</p>
</div>
<div class="paragraph">
<p>専用端末のフォアグラウンドでプロセスを実行することができます。サーバを終了するには <code>CTRL+C</code> を押してください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ shadow-cljs server

////
# or (if you'd like REPL to control the server process)
////
#または（REPLにサーバープロセスを制御させたい場合
$ shadow-cljs clj-repl</code></pre>
</div>
</div>
<div class="paragraph">
<p>また、一般的な`start|stop|restart` 関数を使って、バックグランドでサーバーを制御することもできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ shadow-cljs start
$ shadow-cljs stop
$ shadow-cljs restart</code></pre>
</div>
</div>
<div class="paragraph">
<p>いずれかのサーバーが起動していれば、他のすべてのコマンドはそのサーバーを使用し、より速く動作します。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ビルドツールの統合"><a class="anchor" href="#_ビルドツールの統合"></a><a class="link" href="#_ビルドツールの統合">3.2. ビルドツールの統合</a></h3>
<div class="paragraph">
<p><code>shadow-cljs</code> は他の Clojure ツールと統合することができます。なぜなら、主要な配布物は <a href="https://clojars.org/thheller/shadow-cljs">Clojars</a> を通じて入手できる <code>.jar</code> ファイルだからです。デフォルトでは <code>:dependencies</code> は <code>shadow-cljs.edn</code> で管理されますが、他のビルドツールを使って依存関係を管理することもできます。</p>
</div>
<div class="paragraph">
<p>注意: スタンドアロンの <code>shadow-cljs</code> バージョンを使用することを強くお勧めします。このコマンドは、UX を最適化するために、他のツールでは行われない多くのことを行います (例えば、起動の高速化など)。また、依存関係の衝突やその他の関連するエラーに対処するための多くの頭痛の種を避けることができるでしょう。</p>
</div>
<div class="sect3">
<h4 id="Leiningen"><a class="anchor" href="#Leiningen"></a><a class="link" href="#Leiningen">3.2.1. Leiningen</a></h4>
<div class="paragraph">
<p><a href="https://leiningen.org/">Leiningen</a> を使って依存関係を管理したい場合は、<code>shadow-cljs.edn</code> の設定に <code>:lein</code> エントリを追加することで可能になります。この設定により、<code>shadow-cljs</code> コマンドは JVM を起動する際に <code>lein</code> を使用し、<code>shadow-cljs.edn</code> 内の <code>:source-paths</code> や <code>:dependencies</code> は一切無視し、代わりに <code>project.clj</code> から設定された <code>lein</code> を使用します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:lein</span> <span class="predefined-constant">true</span>
////
 <span class="comment">; :source-paths and :dependencies are now ignored in this file</span>
////
<span class="comment">; :source-paths と :dependencies はこのファイルでは無視されます</span>

////
 <span class="comment">; configure them via project.clj</span>
////
<span class="error">こ</span><span class="error">れ</span><span class="error">ら</span><span class="error">を</span>project.clj<span class="error">で</span><span class="error">設</span><span class="error">定</span><span class="error">す</span><span class="error">る</span>
 <span class="symbol">:builds</span> { <span class="keyword">..</span><span class="keyword">.</span> }</code></pre>
</div>
</div>
<div class="paragraph">
<p>専用の <code>lein</code> プロファイルの使用</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:lein</span> {<span class="symbol">:profile</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">+cljs</span><span class="delimiter">&quot;</span></span>}
 <span class="symbol">:builds</span> {<span class="keyword">..</span><span class="keyword">.</span>}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample project.clj</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(defproject my-awesome-project
  <span class="keyword">..</span><span class="keyword">.</span>
  <span class="symbol">:profiles</span>
  {<span class="symbol">:cljs</span>
   {<span class="symbol">:source-paths</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">src/cljs</span><span class="delimiter">&quot;</span></span>]
    <span class="symbol">:dependencies</span> [[thheller/shadow-cljs <span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>]
                   [reagent <span class="string"><span class="delimiter">&quot;</span><span class="content">0.8.1</span><span class="delimiter">&quot;</span></span>]]}})</code></pre>
</div>
</div>
<div class="paragraph">
<p>project.clj を使って :dependencies を管理する場合、 <a href="https://clojars.org/thheller/shadow-cljs">thheller/shadow-cljs</a> アーティファクトを :dependencies に (直接またはプロファイルで) 手動で含める必要があります。</p>
</div>
<div class="paragraph">
<p>重要: <code>shadow-cljs</code> の起動時やコンパイル・ビルド時に奇妙な Java Stackstraces に遭遇した場合、依存関係の衝突が考えられます。重要なのは、<code>shadow-cljs</code> が、適切にマッチした <code>org.clojure/clojurescript</code> と <code>closure-compiler</code> のバージョンと一緒に使われていることです。必要なバージョンは <a href="https://clojars.org/thheller/shadow-cljs">clojars</a> (右側)にリストアップされていますので、 <code>lein deps :tree</code> で確認できます。</p>
</div>
<div class="sect4">
<h5 id="_leiningen_から直接タスクを実行する"><a class="anchor" href="#_leiningen_から直接タスクを実行する"></a><a class="link" href="#_leiningen_から直接タスクを実行する">Leiningen から直接タスクを実行する</a></h5>
<div class="paragraph">
<p>また、`shadow-cljs`コマンド自体を使いたくない場合は、`lein`を使って`shadow-cljs`コマンドを直接実行することもできます。</p>
</div>
<div class="paragraph">
<p>重要: コマンドを実行する際には、引き続き <code>shadow-cljs</code> コマンドを使用することをお勧めします。このコマンドは、実行中のサーバーモードのインスタンスを最大限に活用します。これにより、`lein`を直接使用して追加のJVMを起動するよりも、大幅に速くコマンドを実行することができます。</p>
</div>
<div class="paragraph">
<p>REPLやライブリロードは不要で、devモードで一度コンパイルするだけです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ lein run -m shadow.cljs.devtools.cli compile build-id</code></pre>
</div>
</div>
<div class="paragraph">
<p>リリースモードに最適化されたビルドを作成します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ lein run -m shadow.cljs.devtools.cli release build-id</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deps-edn"><a class="anchor" href="#deps-edn"></a><a class="link" href="#deps-edn">3.2.2. tools.deps / deps.edn</a></h4>
<div class="paragraph">
<p>新しい <a href="https://clojure.org/guides/deps_and_cli">deps.edn</a> は、ビルトインのメソッドや <code>lein</code> を使用する代わりに、<code>:dependencies</code> や <code>:source-paths</code> を管理するのにも使用できます。すべての <code>shadow-cljs</code> コマンドは、代わりに新しい <code>clojure</code> ユーティリティを介して起動されます。</p>
</div>
<div class="paragraph">
<p>重要: <code>tools.deps</code> は現在も頻繁に変更されています。必ず最新のバージョンを使用してください。</p>
</div>
<div class="paragraph">
<p>これを使うには、設定で <code>:deps true</code> プロパティを設定します。また、どの <code>deps.edn</code> のエイリアスを使用するかを設定することもできます。</p>
</div>
<div class="paragraph">
<p><code>thheller/shadow-cljs</code> の artifact(成果物) を手動で <code>deps.edn</code> に追加する必要があります。</p>
</div>
<div class="paragraph">
<p>シンプルな shadow-cljs.edn の例</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:deps</span> <span class="predefined-constant">true</span>
 <span class="symbol">:builds</span> <span class="keyword">..</span><span class="keyword">.</span>}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">シンプルな <code>deps.edn</code> の例</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:paths</span> [<span class="keyword">..</span><span class="keyword">.</span>]
 <span class="symbol">:deps</span> {thheller/shadow-cljs {<span class="symbol">:mvn/version</span> &lt;latest&gt;}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>例 <code>shadow-cljs.edn</code> に :cljs のエイリアスをつけたもの</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:deps</span> {<span class="symbol">:aliases</span> [<span class="symbol">:cljs</span>]}
 <span class="symbol">:builds</span> <span class="keyword">..</span><span class="keyword">.</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>deps.edn の例</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:paths</span> [<span class="keyword">..</span><span class="keyword">.</span>]
 <span class="symbol">:deps</span> {<span class="keyword">..</span><span class="keyword">.</span>}
 <span class="symbol">:aliases</span>
 {<span class="symbol">:cljs</span>
  {<span class="symbol">:extra-deps</span> {thheller/shadow-cljs {<span class="symbol">:mvn/version</span> &lt;latest&gt;}}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>clj で直接実行する。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:paths</span> [<span class="keyword">..</span><span class="keyword">.</span>]
 <span class="symbol">:deps</span> {<span class="keyword">..</span><span class="keyword">.</span>}
 <span class="symbol">:aliases</span>
 {<span class="symbol">:shadow-cljs</span>
  {<span class="symbol">:extra-deps</span> {thheller/shadow-cljs {<span class="symbol">:mvn/version</span> &lt;latest&gt;}}
   <span class="symbol">:main-opts</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">-m</span><span class="delimiter">&quot;</span></span> <span class="string"><span class="delimiter">&quot;</span><span class="content">shadow.cljs.devtools.cli</span><span class="delimiter">&quot;</span></span>]}}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">clj -A<span class="symbol">:shadow-cljs</span> watch app</code></pre>
</div>
</div>
<div class="paragraph">
<p>また、<code>shadow-cljs -A:foo:bar &#8230;&#8203;</code> のように、コマンドラインで <code>-A</code> を使って追加のエイリアスを指定することもできます。</p>
</div>
<div class="paragraph">
<p>重要：エイリアスは、新しいインスタンか/サーバを起動したときにのみ適用されます。shadow-cljs コマンドを使って稼働中のサーバに接続するときには適用されません。clj`で起動すると、常に新しいJVMを起動することになり、サーバ・モードをサポートしません。</p>
</div>
</div>
<div class="sect3">
<h4 id="_boot"><a class="anchor" href="#_boot"></a><a class="link" href="#_boot">3.2.3. Boot</a></h4>
<div class="paragraph">
<p>著者はBootの経験がほとんどないため、この章は貢献を必要としています。私たちはBootでは、関数からツールチェーンを構築できることを理解しています。shadow-cljsは普通のJVM ライブラリなので、その中の関数を呼び出してタスクを起動することができます。</p>
</div>
<div class="paragraph">
<p>いくつかの Boot タスクはここで利用可能です。
<a href="https://github.com/jgdavey/boot-shadow-cljs" class="bare">https://github.com/jgdavey/boot-shadow-cljs</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="clj-run"><a class="anchor" href="#clj-run"></a><a class="link" href="#clj-run">3.3. Clojureコードの実行</a></h3>
<div class="paragraph">
<p>コマンドラインから特定のClojure関数を呼び出すために、`shadow-cljs`というCLIを使うことができます。これは、あるタスクの前後にコードを実行したいときに便利です。例えば、`release`ビルドの出力をリモートサーバに`rsync`したいとします。</p>
</div>
<div class="paragraph">
<p>例 `src/my/build.clj`における Clojure の名前空間</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">my.build</span>
  (<span class="symbol">:require</span>
    [shadow.cljs.devtools.api <span class="symbol">:as</span> shadow]
    [clojure.java.shell <span class="symbol">:refer</span> (sh)]))

(<span class="keyword">defn</span> <span class="function">release</span> []
  (shadow/release <span class="symbol">:my-build</span>)
  (sh <span class="string"><span class="delimiter">&quot;</span><span class="content">rsync</span><span class="delimiter">&quot;</span></span> <span class="string"><span class="delimiter">&quot;</span><span class="content">-arzt</span><span class="delimiter">&quot;</span></span> <span class="string"><span class="delimiter">&quot;</span><span class="content">path/to/output-dir</span><span class="delimiter">&quot;</span></span> <span class="string"><span class="delimiter">&quot;</span><span class="content">my@server.com:some/path</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>release 関数の実行</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ shadow-cljs clj-run my.build/release
# または
$ shadow-cljs run my.build/release</code></pre>
</div>
</div>
<div class="paragraph">
<p>呼び出された関数には、コマンドラインから引数を渡すことができます。</p>
</div>
<div class="paragraph">
<p>通常のClojure fnの引数を使った引数の使用</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">..</span><span class="keyword">.</span>
(<span class="keyword">defn</span> <span class="function">release</span> [server]
  (shadow/release <span class="symbol">:my-build</span>)
  (sh <span class="string"><span class="delimiter">&quot;</span><span class="content">rsync</span><span class="delimiter">&quot;</span></span> <span class="string"><span class="delimiter">&quot;</span><span class="content">-arzt</span><span class="delimiter">&quot;</span></span> <span class="string"><span class="delimiter">&quot;</span><span class="content">path/to/output-dir</span><span class="delimiter">&quot;</span></span> server))</code></pre>
</div>
</div>
<div class="paragraph">
<p>コマンドラインからのサーバーの受け渡し</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ shadow-cljs clj-run my.build/release my@server.com:some/path</code></pre>
</div>
</div>
<div class="paragraph">
<p>ヒント: <a href="https://github.com/clojure/tools.cli">tools.cli</a>のように引数を解析したい場合は、通常の <code>(defn release [&amp; args])</code> の構造でも動作します。</p>
</div>
<div class="paragraph">
<p>ここでは、Clojureのフルパワーにアクセスできます。必要に応じて、この上にツール全体を構築することができます。おまけに、この方法で書いたものはすべて、Clojure REPLで直接利用できます。</p>
</div>
<div class="paragraph">
<p>重要：<a href="#server-mode">server</a> が実行されている場合、名前空間は自動的にはリロードされず、一度だけロードされます。REPLを使って開発を行い、通常通りファイルをリロードすることをお勧めします（例：<code>(require 'my.build :reload)</code>)。
`shadow-cljs clj-eval "(require 'my.build :reload)"`を実行して、コマンドラインから手動でリロードすることもできます。</p>
</div>
<div class="sect3">
<h4 id="_clj_run_による_watch_の呼び出し"><a class="anchor" href="#_clj_run_による_watch_の呼び出し"></a><a class="link" href="#_clj_run_による_watch_の呼び出し">3.3.1. clj-run による watch の呼び出し</a></h4>
<div class="paragraph">
<p>デフォルトでは、<code>clj-run</code> から呼び出された関数は、<code>compile</code>, <code>release</code> やその他の Clojure 機能を実行するのに十分な、最小限の <code>shadow-cljs</code> ランタイムにしかアクセスできません。関数が完了すると、JVMは終了します。</p>
</div>
<div class="paragraph">
<p>あるビルドに対して <code>watch</code> を開始したい場合は、呼び出している関数が完全なサーバを必要とすることを宣言する必要があります。これにより、あなたが明示的に <code>(shadow.cljs.devtools.server/stop!)</code> を呼び出すか、<code>CTRL+C</code> でプロセスを停止させるまで、そのプロセスは生き続けます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">demo.run</span>
  (<span class="symbol">:require</span> [shadow.cljs.devtools.api <span class="symbol">:as</span> shadow]))

////
<span class="comment">;; this fails because a full server instance is missing</span>
////
<span class="comment">;; これは完全なサーバ・インスタンスがないために失敗します</span>
(<span class="keyword">defn</span> <span class="function">foo</span>
  [&amp; args]
  (shadow/watch <span class="symbol">:my-build</span>))

////
<span class="comment">;; this metadata will ensure that the server is started so watch works</span>
////
<span class="comment">;; このメタデータは、時計が動作するようにサーバーを起動することを保証します</span>
(<span class="keyword">defn</span> <span class="function">foo</span>
  {<span class="symbol">:shadow/requires-server</span> <span class="predefined-constant">true</span>}
  [&amp; args]
  (shadow/watch <span class="symbol">:my-build</span>))</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_repl_2"><a class="anchor" href="#_repl_2"></a><a class="link" href="#_repl_2">4. REPL</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>REPLは、Clojure(Script)のコードを扱う際に、非常に強力なツールです。shadow-cljs` は、すぐに始められるいくつかのビルトインバージョンと、標準的なビルドに統合されるバージョンを提供します。</p>
</div>
<div class="paragraph">
<p>いくつかのコードをすぐにテストしたい場合は、内蔵のREPLで十分です。自分で何かをするような、より複雑なセットアップが必要な場合は、実際のビルドを使うのが一番です。</p>
</div>
<div class="sect2">
<h3 id="_clojurescript_repl"><a class="anchor" href="#_clojurescript_repl"></a><a class="link" href="#_clojurescript_repl">4.1. ClojureScript REPL</a></h3>
<div class="paragraph">
<p>デフォルトでは、<code>node-repl`と`browser-repl`のどちらかを選択することができます。どちらも似たような動作をしますが、違いは、一方がマネージドな `node.js</code> プロセスで動作するのに対し、他方は実際のコードを評価するために使用されるブラウザウィンドウを開くことです。</p>
</div>
<div class="sect3">
<h4 id="node-repl"><a class="anchor" href="#node-repl"></a><a class="link" href="#node-repl">4.1.1. Node REPL</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ shadow-cljs node-repl</code></pre>
</div>
</div>
<div class="paragraph">
<p>これは、すでに接続されている <code>node</code> プロセスで、空の CLJS REPL を開始します。</p>
</div>
<div class="paragraph">
<p>重要：Node REPLを終了すると、`node`プロセスもキルされます。</p>
</div>
<div class="paragraph">
<p>node-repl`を使えば、追加の設定をすることなく、すぐに使い始めることができます。node-replは、`(require '[your.core :as x])`という通常の方法で、あなたのすべてのコードにアクセスします。ビルドに接続されていないので、ファイルが変更されてもコードの自動再構築は行われず、ホットリロードも提供されません。</p>
</div>
</div>
<div class="sect3">
<h4 id="browser-repl"><a class="anchor" href="#browser-repl"></a><a class="link" href="#browser-repl">4.1.2. Browser REPL</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ shadow-cljs browser-repl</code></pre>
</div>
</div>
<div class="paragraph">
<p>これは、空のCLJS REPLを起動し、コードが実行される関連するブラウザのウィンドウを開きます。ブラウザ上で実行されるだけでなく、上記の <code>node-repl</code> と同じ機能を持っています。</p>
</div>
<div class="paragraph">
<p>重要：ブラウザウィンドウを閉じると、REPLは動作しなくなります。</p>
</div>
</div>
<div class="sect3">
<h4 id="build-repl"><a class="anchor" href="#build-repl"></a><a class="link" href="#build-repl">4.1.3. ビルドに特化した REPL</a></h4>
<div class="paragraph">
<p>node-repl`と`browser-repl`は、特定のビルド構成なしに動作します。つまり、あなたが指示したことだけを実行し、自分では何もしないということです。</p>
</div>
<div class="paragraph">
<p>特定のものをビルドしたい場合は、提供されているビルドターゲットの1つを使ってビルドを設定する必要があります。それらのほとんどは、ClojureScript REPLに必要なコードを自動的に注入します。それは追加の設定を必要としないはずです。ビルドCLJS REPLが動作するためには、次の2つが必要です。</p>
</div>
<div class="paragraph">
<p>ビルドのための実行中の <code>watch</code> です。
ターゲットのJSランタイムを接続します。つまり、`:browser`ターゲットを使用している場合、生成されたJSがロードされているブラウザを開く必要があります。node.jsのビルドの場合は、`node`プロセスの実行を意味します。</p>
</div>
<div class="paragraph">
<p>両方を入手したら、コマンドラインまたはClojure REPLからCLJS REPLに接続できます。</p>
</div>
<div class="listingblock">
<div class="title">CLI</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ shadow-cljs watch build-id
...

////
# different terminal
////
# 異なるターミナル
$ shadow-cljs cljs-repl build-id
shadow-cljs - connected to server
[3:1]~cljs.user=&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">REPL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ shadow-cljs clj-repl
...
[2:0]~shadow.user=&gt; (shadow/watch :browser)
[:browser] Configuring build.
[:browser] Compiling ...
[:browser] Build completed. (341 files, 1 compiled, 0 warnings, 3,19s)
:watching
[2:0]~shadow.user=&gt; (shadow/repl :browser)
[2:1]~cljs.user=&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
REPLを終了するには、<code>:repl/quit`と入力してください。これは REPL を終了するだけで、`watch</code> は引き続き実行されます。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>ヒント: 複数の <code>watch</code> 「ワーカー」を並行して実行し、任意の時間にそれらの REPL に接続/切断することができます。</p>
</div>
<div class="listingblock">
<div class="title">No connected のランタイムエラーが発生しました。</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">[3:1]~cljs.user=&gt; (js/alert &quot;foo&quot;)
There is no connected JS runtime.</code></pre>
</div>
</div>
<div class="paragraph">
<p>これが表示された場合、ブラウザでアプリを開くか、`node`プロセスを開始する必要があります。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_clojure_repl"><a class="anchor" href="#_clojure_repl"></a><a class="link" href="#_clojure_repl">4.2. Clojure REPL</a></h3>
<div class="paragraph">
<p>提供されているClojureScript REPLに加えて、Clojure REPLも提供されています。これは、`shadow-cljs`プロセスを制御し、他のすべてのビルドコマンドを実行するために使用できます。Clojure REPLから始めて、いつでもCLJS REPLにアップグレードすることができます(そして元に戻すこともできます)。</p>
</div>
<div class="listingblock">
<div class="title">CLIからの実行</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ shadow-cljs clj-repl
...
shadow-cljs - REPL - see (help), :repl/quit to exit
[1:0]~shadow.user=&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>名前空間 <code>shadow.cljs.devtools.api</code> には、CLI に対応する関数とほぼ1対1に対応する関数があります。デフォルトでは <code>shadow</code> という名前でエイリアスされています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="comment">;; shadow-cljs watch foo</span>
(shadow.cljs.devtools.api/watch <span class="symbol">:foo</span>)

<span class="comment">;; これは、nsのエイリアスが用意されているため、同じです。</span>
(shadow/watch <span class="symbol">:foo</span>)

<span class="comment">;; shadow-cljs watch foo --verbose</span>
(shadow/watch <span class="symbol">:foo</span> {<span class="symbol">:verbose</span> <span class="predefined-constant">true</span>})

<span class="comment">;; shadow-cljs compile foo</span>
(shadow/compile <span class="symbol">:foo</span>)

<span class="comment">;; shadow-cljs release foo</span>
(shadow/release <span class="symbol">:foo</span>)

<span class="comment">;; shadow-cljs browser-repl</span>
(shadow/browser-repl)

<span class="comment">;; shadow-cljs node-repl</span>
(shadow/node-repl)

<span class="comment">;; shadow-cljs cljs-repl foo</span>
(shadow/repl <span class="symbol">:foo</span>)

<span class="comment">;; CLJS REPLに入ったら、:repl/quit や cljs/quit を使ってCLJに戻ることができます。</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="embedded"><a class="anchor" href="#embedded"></a><a class="link" href="#embedded">4.2.1. 組み込み</a></h4>
<div class="paragraph">
<p>また、他の CLJ プロセスの中から完全に <code>shadow-cljs</code> を使用することも可能です。クラスパスに <code>thheller/shadow-cljs</code> がロードされていれば、問題ありません。</p>
</div>
<div class="listingblock">
<div class="title">lein repl`を使った例</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ lein repl
nREPL server started on port 57098 on host 127.0.0.1 - nrepl://127.0.0.1:57098
REPL-y 0.4.3, nREPL 0.6.0
Clojure 1.10.0
...

user=&gt; (require '[shadow.cljs.devtools.server :as server])
nil
user=&gt; (server/start!)
...
:shadow.cljs.devtools.server/started
user=&gt; (require '[shadow.cljs.devtools.api :as shadow])
nil
user=&gt; (shadow/compile :foo)
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>(shadow.cljs.devtools.server/stop!)`を実行することで、組み込みサーバを停止することができます。これにより、実行中のすべてのビルドプロセスも停止します。</p>
</div>
<div class="paragraph">
<p>重要: CLJS REPLに切り替えたい場合は、サーバーの起動に使用したツールで追加の設定が必要になる場合があります。lein` はデフォルトで nREPL を使用するので、追加の nREPL <code>:middleware</code> を設定する必要があります。clj`を使用する場合は、nREPLを使用しないので、問題ありません。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="config"><a class="anchor" href="#config"></a><a class="link" href="#config">5. 設定</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>shadow-cljs` は、プロジェクトのルートディレクトリにある <code>shadow-cljs.edn</code> ファイルによって設定されます。デフォルトのファイルを作成するには
shadow-cljs init` を実行することで、デフォルトのファイルを作成することができます。このファイルには、いくつかのグローバルな設定を含むマップと
マップと、すべてのビルドのための <code>:builds</code> エントリが含まれています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:source-paths</span> [<span class="keyword">..</span><span class="keyword">.</span>]
 <span class="symbol">:dependencies</span> [<span class="keyword">..</span><span class="keyword">.</span>]
 <span class="symbol">:builds</span> {<span class="keyword">..</span><span class="keyword">.</span>}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>設定例は以下のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:dependencies</span>
 [[reagent <span class="string"><span class="delimiter">&quot;</span><span class="content">0.8.0-alpha2</span><span class="delimiter">&quot;</span></span>]]

 <span class="symbol">:source-paths</span>
 [<span class="string"><span class="delimiter">&quot;</span><span class="content">src</span><span class="delimiter">&quot;</span></span>]

 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span> {<span class="symbol">:target</span> <span class="symbol">:browser</span>
        <span class="symbol">:output-dir</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">public/js</span><span class="delimiter">&quot;</span></span>
        <span class="symbol">:asset-path</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/js</span><span class="delimiter">&quot;</span></span>
        <span class="symbol">:modules</span> {<span class="symbol">:main</span> {<span class="symbol">:entries</span> [my.app]}}}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>この例のファイル構造は次のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">.
├── package.json
├── shadow-cljs.edn
└── src
    └── my
        └── app.cljs</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="source-paths"><a class="anchor" href="#source-paths"></a><a class="link" href="#source-paths">5.1. ソースのパス</a></h3>
<div class="paragraph">
<p>:source-paths` は、JVMのクラスパスを設定します。コンパイラはこの設定を使って、Clojure(Script)のソースファイル(例：.cljs`)を探します。</p>
</div>
<div class="paragraph">
<p>すべてを1つのソースパスにまとめても問題ありませんが、ソースファイルを特定の方法で「グループ化」したい場合は、複数のソースパスを使用することができます。例えば、テストを別々にしたい場合などに便利です。</p>
</div>
<div class="listingblock">
<div class="title">複数のソースパスの使用</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:source-paths</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">src/main</span><span class="delimiter">&quot;</span></span> <span class="string"><span class="delimiter">&quot;</span><span class="content">src/test</span><span class="delimiter">&quot;</span></span>]
 <span class="keyword">..</span><span class="keyword">.</span>}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">.
├── package.json
├── shadow-cljs.edn
└── src
    └── main
        └── my
            └── app.cljs
    └── test
        └── my
            └── app_test.cljs</code></pre>
</div>
</div>
<div class="paragraph">
<p>ソースファイルを拡張子で分けることはお勧めしません（例：<code>src/clj</code>, <code>src/cljs</code>, <code>src/cljc</code>）。なぜかCLJSのプロジェクトテンプレートではこの方法が広く使われていますが、使いにくくなるだけです。</p>
</div>
</div>
<div class="sect2">
<h3 id="_依存関係"><a class="anchor" href="#_依存関係"></a><a class="link" href="#_依存関係">5.2. 依存関係</a></h3>
<div class="sect3">
<h4 id="_clojure_script"><a class="anchor" href="#_clojure_script"></a><a class="link" href="#_clojure_script">5.2.1. Clojure(Script)</a></h4>
<div class="paragraph">
<p>依存関係は、<code>shadow-cljs.edn</code> 設定ファイルのルートにある <code>:dependencies</code> キーによって管理されます。これらは <code>lein</code> や <code>boot</code> のような他の Clojure ツールが使用するのと同じ記法で宣言されます。</p>
</div>
<div class="paragraph">
<p>各依存関係は`[ライブラリ名 "バージョン-文字列"]`を使ったベクターとして書かれ、1つの外側のベクターに入れ子になっています。</p>
</div>
<div class="listingblock">
<div class="title">例 :dependencies</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:source-paths</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">src</span><span class="delimiter">&quot;</span></span>]
 <span class="symbol">:dependencies</span> [[reagent <span class="string"><span class="delimiter">&quot;</span><span class="content">0.9.1</span><span class="delimiter">&quot;</span></span>]]
 <span class="symbol">:builds</span> <span class="keyword">..</span><span class="keyword">.</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>ソースパスは設定全体で一度しか指定されていないことに注意してください。システムは名前空間の依存関係グラフを使って、どのようなコードがビルドの最終出力に必要かを判断します。</p>
</div>
</div>
<div class="sect3">
<h4 id="npm-install"><a class="anchor" href="#npm-install"></a><a class="link" href="#npm-install">5.2.2. JavaScript</a></h4>
<div class="paragraph">
<p><code>shadow-cljs</code> は、https://www.npmjs.com/[<code>npm</code>] エコシステムと完全に統合して、JavaScript の依存関係を管理します。</p>
</div>
<div class="paragraph">
<p>依存関係の管理には、`npm`や`yarn`を使うことができますが、それぞれのドキュメントを参照してください。</p>
</div>
<div class="paragraph">
<p>どちらも、プロジェクトディレクトリ内の <code>package.json</code> ファイルで依存関係を管理します。 npm` で入手できるほとんどすべてのパッケージには、そのインストール方法が説明されています。これらの説明は、現在では <code>shadow-cljs</code> にも適用されています。</p>
</div>
<div class="listingblock">
<div class="title">JavaScriptパッケージのインストール</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># npm
$ npm install the-thing

# yarn
$ yarn add the-thing</code></pre>
</div>
</div>
<div class="paragraph">
<p>それ以上は何も必要ありません。依存関係は <code>package.json</code> ファイルに追加され、これを使って管理されます。</p>
</div>
<div class="paragraph">
<p>ヒント: <code>package.json</code> がまだない場合は、コマンドラインから <code>npm init</code> を実行してください。</p>
</div>
<div class="sect4">
<h5 id="_missing_js_dependency"><a class="anchor" href="#_missing_js_dependency"></a><a class="link" href="#_missing_js_dependency">Missing JS Dependency?</a></h5>
<div class="paragraph">
<p>JSの依存関係の欠落に関連するエラーに遭遇するかもしれません。ほとんどの ClojureScript ライブラリは、使用する <code>npm</code> パッケージをまだ宣言していません。なぜなら、彼らはまだ <a href="#cljsjs">CLJSJS</a> を使用することを期待しているからです。私たちは <code>npm</code> を直接使用したいと考えています。つまり、ライブラリが適切に <code>:npm-deps</code> を宣言するまで、<code>npm</code> パッケージを手動でインストールする必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">The required JS dependency &quot;react&quot; is not available, it was required by ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>必要なJSの依存関係である "react "が利用できません。これは、&#8230;&#8203;によって必要とされていました。</p>
</div>
<div class="paragraph">
<p>これは、`npm install react`ということです。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<code>react</code> の場合は、おそらく以下の3つのパッケージが必要です。npm install react react-dom create-react-class`.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="user-config"><a class="anchor" href="#user-config"></a><a class="link" href="#user-config">5.3. ユーザの設定</a></h3>
<div class="paragraph">
<p>ほとんどの設定はプロジェクト自身で <code>shadow-cljs.edn</code> を通して行われますが、いくつかの設定はユーザーに依存しているかもしれません。https://docs.cider.mx[CIDER] のようなツールは、追加の <code>cider-nrepl</code> 依存関係を必要とするかもしれませんが、<code>shadow-cljs.edn</code> 経由でその依存関係を追加しても、Cursive を使用している別のチームメンバーには意味がありません。</p>
</div>
<div class="paragraph">
<p>制限された設定オプションのセットを <code>~/.shadow-cljs/config.edn</code> に追加することで、このユーザーのマシン上でビルドされたすべてのプロジェクトに適用されます。</p>
</div>
<div class="paragraph">
<p>依存関係を追加するには、通常の <code>:dependencies</code> キーを使用します。ここで追加された依存関係は、すべてのプロジェクトに適用されることに注意してください。依存関係は最小限にして、ツール関連の依存関係だけをここに置くようにしてください。ビルドに関連するものはすべて <code>shadow-cljs.edn</code> に置いておくべきで、そうしないと他のユーザーがコンパイルできない可能性があります。これらの依存関係は、<code>deps.edn</code> や <code>lein</code> を使用する際にも自動的に追加されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:dependencies</span>
 [[cider/cider-nrepl <span class="string"><span class="delimiter">&quot;</span><span class="content">0.21.1</span><span class="delimiter">&quot;</span></span>]]}
<span class="comment">;; this version may be out of date, check whichever is available</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>deps.edn` を使って依存関係を解決する際に、追加のエイリアスを有効にしたい場合があります。これは <code>:deps-aliases</code> で行うことができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="comment">;; プロジェクト内のshadow-cljs.edn</span>
{<span class="symbol">:deps</span> {<span class="symbol">:aliases</span> [<span class="symbol">:cljs</span>]}}

<span class="comment">;; ~/.shadow-cljs/config.edn</span>
{<span class="symbol">:deps-aliases</span> [<span class="symbol">:cider</span>]}</code></pre>
</div>
</div>
<div class="paragraph">
<p>これにより、<code>deps.edn</code> を使用しているプロジェクトでは、<code>shadow-cljs</code> コマンドが <code>[:cider :cljs]</code> のエイリアスを使用するようになります。これは、あなたの <code>~/.clojure/deps.edn</code> に追加の <code>:cider</code> エイリアスがある場合に便利かもしれません。</p>
</div>
<div class="paragraph">
<p>デフォルトでは、<code>shadow-cljs</code> サーバーモードでは、組み込まれた nREPL サーバーが起動しますが、これは必要ないかもしれません。これを無効にするには、ユーザー設定で <code>:nrepl false</code> を設定します。</p>
</div>
<div class="paragraph">
<p>ユーザー設定で現在受け入れられている値は、<a href="#open-file-command">:open-file-command</a>のみです。他のオプションは現在のところ何の効果もありません。</p>
</div>
</div>
<div class="sect2">
<h3 id="_サーバのオプション"><a class="anchor" href="#_サーバのオプション"></a><a class="link" href="#_サーバのオプション">5.4. サーバのオプション</a></h3>
<div class="paragraph">
<p>このセクションでは、<code>shadow-cljs</code> サーバーインスタンスを構成するその他のオプションについて説明します。これらはオプションです。</p>
</div>
<div class="sect3">
<h4 id="nREPL"><a class="anchor" href="#nREPL"></a><a class="link" href="#nREPL">5.4.1. nREPL</a></h4>
<div class="paragraph">
<p><code>shadow-cljs</code> <a href="#server-mode">server</a> は TCP 経由で <a href="https://nrepl.org">nREPL</a> サーバを提供しています。起動メッセージを見ると、nREPLのポートが表示され、そのポートは`target/shadow-cljs/nrepl.port`にも保存されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ shadow-cljs watch app
shadow-cljs - HTTP server available at http://localhost:8600
shadow-cljs - server version: &lt;version&gt; running at http://localhost:9630
shadow-cljs - nREPL server started on port 64967
shadow-cljs - watching build :app
[:app] Configuring build.
[:app] Compiling ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>shadow-cljs.edn`でポートや追加のミドルウェアを設定することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:nrepl</span> {<span class="symbol">:port</span> <span class="integer">9000</span>
         <span class="symbol">:middleware</span> []} <span class="comment">; optional list of namespace-qualified symbols</span>
 <span class="keyword">..</span><span class="keyword">.</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>~/.nrepl/nrepl.edn` にあるデフォルトのグローバルコンフィグファイルや、ローカルの <code>.nrepl.edn</code> も起動時に読み込まれ、<code>:middleware</code> の設定に使用できます。</p>
</div>
<div class="paragraph">
<p>人気のミドルウェア <a href="https://github.com/clojure-emacs/cider-nrepl">cider-nrepl</a> がクラスパス上にあれば（例：<code>:dependencies</code> に含まれている）、自動的に使用されます。追加の設定は必要ありません。これを無効にするには、`:nrepl {:cider false}`を設定します。</p>
</div>
<div class="paragraph">
<p>nrepl`オプションで`:init-ns`を設定することで、接続時に起動する名前空間を設定することができます。デフォルトでは <code>shadow.user</code> となります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:nrepl</span> {<span class="symbol">:init-ns</span> my.repl}
 <span class="keyword">..</span><span class="keyword">.</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>nREPLサーバーは、`:nrepl false`を設定することで無効にすることができます。</p>
</div>
<div class="sect4">
<h5 id="_nrepl_usage"><a class="anchor" href="#_nrepl_usage"></a><a class="link" href="#_nrepl_usage">nREPL Usage</a></h5>
<div class="paragraph">
<p>nREPLサーバーに接続すると、接続は常にClojure REPLとして開始されます。CLJS REPLへの切り替えは、<a href="#cljs-repl">non-nREPL version</a>と同様に動作します。まず、与えられたビルドの <code>watch</code> を開始する必要があり、次に現在の nREPL セッションをそのビルドに切り替えるために、このビルドを選択する必要があります。ビルドを選択すると、すべての評価はClojureではなくClojureScriptで行われます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="repl">(shadow/watch :the-build)
(shadow/repl :the-build)</code></pre>
</div>
</div>
<div class="paragraph">
<p>ヒント: Clojure に戻るには <code>:cljs/quit</code> を使います。</p>
</div>
</div>
<div class="sect4">
<h5 id="_組み込み型nreplサーバ"><a class="anchor" href="#_組み込み型nreplサーバ"></a><a class="link" href="#_組み込み型nreplサーバ">組み込み型nREPLサーバ</a></h5>
<div class="paragraph">
<p>////Embedded nREPL Server////</p>
</div>
<div class="paragraph">
<p>独自のnREPLサーバを提供する他のツール（例：<code>lein</code>）に`shadow-cljs`を組み込んで使用する場合は、`shadow-cljs`ミドルウェアを設定する必要があります。そうしないと、CLJとCLJSのREPLの間で切り替えることができません。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(defproject my-amazing-project <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0.0</span><span class="delimiter">&quot;</span></span>
  <span class="keyword">..</span><span class="keyword">.</span>
  <span class="symbol">:repl-options</span>
  {<span class="symbol">:init-ns</span> shadow.user <span class="comment">;; or any of your choosing</span>
   <span class="symbol">:nrepl-middleware</span>
   [shadow.cljs.devtools.server.nrepl/middleware]}
  <span class="keyword">..</span><span class="keyword">.</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>ヒント：CLJS REPLを使用する前に、<a href="#embedded">embedded server</a>を手動で起動する必要があります。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="socket-repl"><a class="anchor" href="#socket-repl"></a><a class="link" href="#socket-repl">5.4.2. Socket REPL</a></h4>
<div class="paragraph">
<p>Clojure Socket REPLは、サーバーモードで自動的に起動され、デフォルトでランダムなポートを使用します。ツールは、ポート番号を含む <code>.shadow-cljs/socket-repl.port</code> をチェックすることで、起動されたポートを見つけることができます。</p>
</div>
<div class="paragraph">
<p>また、`shadow-cljs.edn`で固定のポートを設定することもできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:socket-repl</span>
 {<span class="symbol">:port</span> <span class="integer">9000</span>}
 <span class="keyword">..</span><span class="keyword">.</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Socket REPLは、`:socket-repl false`を設定することで無効にすることができます。</p>
</div>
</div>
<div class="sect3">
<h4 id="_ssl"><a class="anchor" href="#_ssl"></a><a class="link" href="#_ssl">5.4.3. SSL</a></h4>
<div class="paragraph">
<p>shadow-cljs`のHTTPサーバはSSLをサポートしています。そのためには、一致する秘密鍵と証明書を提供するJava Keystoreが必要です。</p>
</div>
<div class="listingblock">
<div class="title">`shadow-cljs.edn`にSSLが設定されています。</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:ssl</span> {<span class="symbol">:keystore</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">ssl/keystore.jks</span><span class="delimiter">&quot;</span></span>
       <span class="symbol">:password</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">shadow-cljs</span><span class="delimiter">&quot;</span></span>}
 <span class="keyword">..</span><span class="keyword">.</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>上記はデフォルトなので、これらを使用したい場合は、`:ssl {}`を設定するだけで問題ありません。</p>
</div>
<div class="paragraph">
<p>java <code>keytool</code> コマンドを使ってキーストアを作成することができます。信頼できる自己署名証明書を作成することも可能ですが、やや複雑です。</p>
</div>
<div class="paragraph">
<p>作成された <code>Certificates.p12</code> (macOS) または <code>localhost.pfx</code> (Linux, Windows) ファイルは、<code>keytool</code> ユーティリティーを使って、必要な <code>keystore.jks</code> にすることができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ keytool -importkeystore -destkeystore keystore.jks -srcstoretype PKCS12 -srckeystore localhost.pfx</code></pre>
</div>
</div>
<div class="paragraph">
<p>重要：「localhost」（または使用するホスト）のSAN（Subject Alternative Name）を含む証明書を作成する必要があります。SANは、Chromeが証明書を信頼して警告を表示しないようにするために必要です。エクスポート時に使用するパスワードは、キーストアに割り当てられたパスワードと一致する必要があります。</p>
</div>
</div>
<div class="sect3">
<h4 id="http"><a class="anchor" href="#http"></a><a class="link" href="#http">5.4.4. Primary HTTP(S)</a></h4>
<div class="paragraph">
<p>shadow-cljs`サーバは、1つのプライマリHTTPサーバを起動します。このサーバは、ホットリロードやREPLクライアントで使用されるUIやウェブソケットを提供するために使用されます。デフォルトでは、9630番ポートで待ち受けます。もしそのポートが使用中であれば、1つ増やして、開いているポートが見つかるまで再試行します。</p>
</div>
<div class="listingblock">
<div class="title">使用するポートを示すスタートアップメッセージ</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">shadow-cljs - server running at http://0.0.0.0:9630</code></pre>
</div>
</div>
<div class="paragraph">
<p>ssl`が設定されている場合、サーバーは代わりに`https://`を介して利用できます。</p>
</div>
<div class="paragraph">
<p>ヒント: <code>:ssl</code> を使用すると、サーバーは自動的に HTTP/2 をサポートします。</p>
</div>
<div class="paragraph">
<p>代わりに独自のポートを設定したい場合は、`:http`の設定で行うことができます。</p>
</div>
<div class="listingblock">
<div class="title">shadow-cljs.edn`に`:http`の設定をする。</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:http</span> {<span class="symbol">:port</span> <span class="integer">12345</span>
        <span class="symbol">:host</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">my.machine.local</span><span class="delimiter">&quot;</span></span>}
 <span class="keyword">..</span><span class="keyword">.</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>:ssl</code> は、サーバーを <code>https://</code> のみに切り替えます。もし、<code>http://</code> のバージョンを維持したい場合は、別の <code>:ssl-port</code> を設定することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:http</span> {<span class="symbol">:port</span> <span class="integer">12345</span>
        <span class="symbol">:ssl-port</span> <span class="integer">23456</span>
        <span class="symbol">:host</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>}
 <span class="keyword">..</span><span class="keyword">.</span>}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dev-http"><a class="anchor" href="#dev-http"></a><a class="link" href="#dev-http">5.4.5. 開発の HTTP(S)</a></h4>
<div class="paragraph">
<p>shadow-cljs`では、<code>:dev-http`という設定項目で、追加の基本的なHTTPサーバを提供することができます。デフォルトでは、これらは設定されたパスからすべての静的ファイルを提供し、リソースが見つからない場合は `index.html</code> にフォールバックします (これは、ブラウザのプッシュステートを使用するアプリケーションを開発する際に、一般的に求められるものです)。</p>
</div>
<div class="paragraph">
<p>これらのサーバは <code>shadow-cljs</code> がサーバモードで動作しているときに自動的に開始されます。これらのサーバーはどのビルドにも特定されず、それぞれにユニークな <code>:output-dir</code> が使用されている限り、複数のビルドのファイルを提供するために使用することができます。</p>
</div>
<div class="paragraph">
<p>重要なことです。これらは、静的ファイルをサーバーする一般的なウェブサーバーです。これらはライブリロードやREPLのロジックには必要ありません。どのようなウェブサーバでも使用できますが、これらは単に利便性のために提供されています。</p>
</div>
<div class="listingblock">
<div class="title">基本的な例では、`http://localhost:8000`を介して`public`ディレクトリを提供しています。</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:dev-http</span> {<span class="integer">8000</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span>}
 <span class="symbol">:builds</span> {<span class="keyword">..</span><span class="keyword">.</span>}}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>:dev-http</code> は <code>port-number</code> から <code>config</code> へのマップを期待しています。この <code>config</code> は、最も一般的なシナリオに対応したいくつかのショートカットをサポートしています。</p>
</div>
<div class="paragraph">
<p>ファイルシステムルートからディレクトリを serve する</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="symbol">:dev-http</span> {<span class="integer">8000</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>クラスルートから serve する</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="symbol">:dev-http</span> {<span class="integer">8000</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:public</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>これは、クラスパス上の <code>public/index.html</code> から <code>/index.html</code> へのリクエストを見つけようとするものです。これは <code>.jar</code> ファイルの中のファイルを含む可能性があります。</p>
</div>
<div class="paragraph">
<p>複数のルートから serve する</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="symbol">:dev-http</span> {<span class="integer">8000</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span> <span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span> <span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:c</span><span class="delimiter">&quot;</span></span>]}</code></pre>
</div>
</div>
<div class="paragraph">
<p>これはまず、クラスパス上の <code>&lt;project-root&gt;/a/index.html</code> 、 <code>&lt;project-root&gt;/b/index.html</code> 、 <code>c/index.html</code> の順に検索を試みます。もし何も見つからなければ、デフォルトのハンドラが呼び出されます。</p>
</div>
<div class="paragraph">
<p>長いバージョンのコンフィグでは、マップが要求され、サポートされているオプションは次のとおりです。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>:root</code></dt>
<dd>
<p>(String) リクエストを処理するためのパスです。classpath:` で始まるパスは、ファイルシステムではなく、クラスパスからリクエストを処理します。すべてのファイルシステムのパスは、プロジェクトのルートからの相対パスです。</p>
</dd>
<dt class="hdlist1"><code>:roots</code></dt>
<dd>
<p>複数のルートパスが必要な場合は、<code>:root</code> の代わりに使用します。</p>
</dd>
<dt class="hdlist1"><code>:ssl-port</code></dt>
<dd>
<p>(文字列のベクトル) ssl`が設定されている場合、ssl接続にはこのポートを使用し、通常のHTTPサーバーは通常のポートを使用します。ssl-port` が設定されておらず、<code>:ssl</code> が設定されている場合、デフォルトのポートは SSL リクエストのみをサーバーします。</p>
</dd>
<dt class="hdlist1"><code>:host</code></dt>
<dd>
<p>オプションです。リッスンするホスト名を指定します。デフォルトでは localhost になります。</p>
</dd>
<dt class="hdlist1"><code>:handler</code></dt>
<dd>
<p>オプションです。完全に修飾されたシンボルです。与えられたリクエストに対してリソースが見つからない場合に使用される <code>(defn handler [req] resp)</code> です。
(defn handler [req] resp)` は、与えられたリクエストに対してリソースが見つからない場合に使用されます。デフォルトでは <code>shadow.http.push-state/handle</code> となります。</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>以下の2つのオプションは、デフォルトの組み込みハンドラを使用する場合にのみ適用され、通常は変更する必要はありません。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>:push-state/headers</code></dt>
<dd>
<p>(オプション) 応答する HTTP ヘッダーのマップです。デフォルトでは、<code>text/html</code> という標準的なヘッダーを使用します。</p>
</dd>
<dt class="hdlist1"><code>:push-state/index</code></dt>
<dd>
<p>(オプション) サービスを提供するファイルです。デフォルトでは <code>index.html</code> が使用されます。</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:dev-http</span>
 {<span class="integer">8080</span> {<span class="symbol">:root</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span>
        <span class="symbol">:handler</span> my.app/handler}}}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="dev-http-proxy"><a class="anchor" href="#dev-http-proxy"></a><a class="link" href="#dev-http-proxy">Reverse Proxy Support</a></h5>
<div class="paragraph">
<p>デフォルトでは、開発サーバーはローカルでリクエストを処理しようとしますが、外部のWebサーバーを使ってリクエストを処理したい場合もあります（例：APIリクエスト）。これは <code>:proxy-url</code> で設定できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:dev-http</span>
 {<span class="integer">8000</span>
  {<span class="symbol">:root</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span>
   <span class="symbol">:proxy-url</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">https://some.host</span><span class="delimiter">&quot;</span></span>}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="http://localhost:8000/api/foo`" class="bare">http://localhost:8000/api/foo`</a> へのリクエストは、代わりに <code><a href="https://some.host/api/foo" class="bare">https://some.host/api/foo</a></code> が返すコンテンツを提供します。ローカルファイルを持たないすべてのリクエストは、プロキシされたサーバーによって提供されます。</p>
</div>
<div class="paragraph">
<p>追加オプション 接続処理を設定するオプションは以下の通りです。
[横型].
<code>:proxy-rewrite-host-header</code>:: boolean, デフォルトは true です。オリジナルの Host ヘッダーを使用するか、<code>:proxy-url</code> からのヘッダーを使用するかを決定します。上記の例では、<code>localhost</code> と <code>some.host</code> のどちらを使用するかを決定します。
<code>:proxy-reuse-x-forwarded</code>:: boolean, デフォルトは false です。プロキシが自分自身を <code>X-Forwarded-For</code> リストに追加するか、新しいリストを開始するかを設定します。
<code>:proxy-max-connection-retries</code>:: int, デフォルトは1です。
<code>:proxy-max-request-time</code>:: intとしてのミリ秒、デフォルトは30000です。30秒のリクエストタイムアウトです。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jvm-opts"><a class="anchor" href="#jvm-opts"></a><a class="link" href="#jvm-opts">5.5. JVM の設定</a></h3>
<div class="paragraph">
<p>JVM の起動に <code>shadow-cljs.edn</code> を使用する場合、JVM に直接渡される追加のコマンドライン引数を設定することができます。例えば、shadow-cljs.edn が使用する RAM の量を減らしたり増やしたりしたい場合があります。</p>
</div>
<div class="paragraph">
<p>これは、<code>shadow-cljs.edn</code> のルートに <code>:jvm-opts</code> を設定して、文字列のベクトルを期待することで行われます。</p>
</div>
<div class="listingblock">
<div class="title">例：RAM使用量を1GBに制限</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:source-paths</span> [<span class="keyword">..</span><span class="keyword">.</span>]
 <span class="symbol">:dependencies</span> [<span class="keyword">..</span><span class="keyword">.</span>]
 <span class="symbol">:jvm-opts</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">-Xmx1G</span><span class="delimiter">&quot;</span></span>]
 <span class="symbol">:builds</span> <span class="keyword">..</span><span class="keyword">.</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>JVMに渡すことができる引数はバージョンによって異なりますが、https://docs.oracle.com/javase/8/docs/technotes/tools/windows/java.html[here]のリストの例があります。RAMの割り当てが少なすぎたり多すぎたりすると、パフォーマンスが低下することがありますのでご注意ください。通常は、デフォルトの設定で十分です。</p>
</div>
<div class="paragraph">
<p>重要: <code>deps.edn</code> や <code>project.clj</code> を使用する場合は、<code>:jvm-opts</code> を設定する必要があります。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ビルドの設定"><a class="anchor" href="#_ビルドの設定"></a><a class="link" href="#_ビルドの設定">6. ビルドの設定</a></h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:dependencies</span> [[some-library <span class="string"><span class="delimiter">&quot;</span><span class="content">1.2.1</span><span class="delimiter">&quot;</span></span>] <span class="keyword">..</span><span class="keyword">.</span>]
 <span class="symbol">:source-paths</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">src</span><span class="delimiter">&quot;</span></span>]
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>   {<span class="symbol">:target</span>     <span class="symbol">:browser</span>
          <span class="keyword">..</span><span class="keyword">.</span> browser-specific options <span class="keyword">..</span><span class="keyword">.</span>}
  <span class="symbol">:tests</span> {<span class="symbol">:target</span> <span class="symbol">:karma</span>
          <span class="keyword">..</span><span class="keyword">.</span> karma-specific options <span class="keyword">..</span><span class="keyword">.</span>}}}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_ビルドターゲット"><a class="anchor" href="#_ビルドターゲット"></a><a class="link" href="#_ビルドターゲット">6.1. ビルドターゲット</a></h3>

</div>
<div class="sect2">
<h3 id="devtools"><a class="anchor" href="#devtools"></a><a class="link" href="#devtools">6.2. 開発オプション</a></h3>
<div class="sect3">
<h4 id="_repl_3"><a class="anchor" href="#_repl_3"></a><a class="link" href="#_repl_3">6.2.1. REPL</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span> {<span class="keyword">..</span><span class="keyword">.</span>
        <span class="symbol">:devtools</span> {<span class="symbol">:repl-init-ns</span> my.app
                   <span class="symbol">:repl-pprint</span> <span class="predefined-constant">true</span>
                   <span class="keyword">..</span><span class="keyword">.</span>}}}}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_プリロード"><a class="anchor" href="#_プリロード"></a><a class="link" href="#_プリロード">6.2.2. プリロード</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span> {<span class="keyword">..</span><span class="keyword">.</span>
        <span class="symbol">:devtools</span> {<span class="symbol">:preloads</span> [fulcro.inspect.preload]
                   <span class="keyword">..</span><span class="keyword">.</span>}}}}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ホットコードリロード"><a class="anchor" href="#_ホットコードリロード"></a><a class="link" href="#_ホットコードリロード">6.2.3. ホットコードリロード</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">shadow-cljs watch build-id</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ライフサイクルフック"><a class="anchor" href="#_ライフサイクルフック"></a><a class="link" href="#_ライフサイクルフック">6.2.4. ライフサイクルフック</a></h4>
<div class="sect4">
<h5 id="_メタデータ"><a class="anchor" href="#_メタデータ"></a><a class="link" href="#_メタデータ">メタデータ</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">my.app</span>)

(<span class="keyword">defn</span> ^<span class="symbol">:dev/before-load</span> stop []
  (js/console.log <span class="string"><span class="delimiter">&quot;</span><span class="content">stop</span><span class="delimiter">&quot;</span></span>))

(<span class="keyword">defn</span> ^<span class="symbol">:dev/after-load</span> start []
  (js/console.log <span class="string"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">my.app</span>)

(<span class="keyword">defn</span> ^<span class="symbol">:dev/before-load-async</span> stop [done]
  (js/console.log <span class="string"><span class="delimiter">&quot;</span><span class="content">stop</span><span class="delimiter">&quot;</span></span>)
  (js/setTimeout
    (<span class="keyword">fn</span> []
      (js/console.log <span class="string"><span class="delimiter">&quot;</span><span class="content">stop complete</span><span class="delimiter">&quot;</span></span>)
      (done)))

(<span class="keyword">defn</span> ^<span class="symbol">:dev/after-load-async</span> start [done]
  (js/console.log <span class="string"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span>)
  (js/setTimeout
    (<span class="keyword">fn</span> []
      (js/console.log <span class="string"><span class="delimiter">&quot;</span><span class="content">start complete</span><span class="delimiter">&quot;</span></span>)
      (done)))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> ^<span class="symbol">:dev/once</span> my.thing)

(js/console.warn <span class="string"><span class="delimiter">&quot;</span><span class="content">will only execute once</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> ^<span class="symbol">:dev/always</span> my.thing)

(js/console.warn <span class="string"><span class="delimiter">&quot;</span><span class="content">will execute on every code change</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_設定"><a class="anchor" href="#_設定"></a><a class="link" href="#_設定">設定</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span> {<span class="keyword">..</span><span class="keyword">.</span>
        <span class="symbol">:devtools</span> {<span class="symbol">:before-load</span>  my.app/stop
                   <span class="symbol">:after-load</span>   my.app/start
                   <span class="keyword">..</span><span class="keyword">.</span>}}}}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="build-hooks"><a class="anchor" href="#build-hooks"></a><a class="link" href="#build-hooks">6.3. ビルドフック</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span> {<span class="symbol">:target</span> <span class="keyword">..</span><span class="keyword">.</span>
        <span class="symbol">:build-hooks</span>
        [(my.util/hook <span class="integer">1</span> <span class="integer">2</span> <span class="integer">3</span>)]
        <span class="keyword">..</span><span class="keyword">.</span>}}}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">my.util</span>)

(<span class="keyword">defn</span> <span class="function">hook</span>
  {<span class="symbol">:shadow.build/stage</span> <span class="symbol">:flush</span>}
  [build-state &amp; args]
  (<span class="keyword">prn</span> [<span class="symbol">:hello-world</span> args])
  build-state)</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="compile-stages"><a class="anchor" href="#compile-stages"></a><a class="link" href="#compile-stages">6.3.1. コンパイル・ステージ</a></h4>

</div>
</div>
<div class="sect2">
<h3 id="_コンパイラ_キャッシュ"><a class="anchor" href="#_コンパイラ_キャッシュ"></a><a class="link" href="#_コンパイラ_キャッシュ">6.4. コンパイラ・キャッシュ</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:cache-blockers</span> #{clara.rules}
 <span class="symbol">:builds</span> {<span class="keyword">..</span><span class="keyword">.</span>}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="symbol">:target</span> <span class="symbol">:browser</span>
   <span class="keyword">..</span><span class="keyword">.</span>
   <span class="symbol">:build-options</span>
   {<span class="symbol">:cache-level</span> <span class="symbol">:off</span>}}}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">target/shadow-cljs/builds/app/dev/ana/cljs/core.cljs.cache.transit.json</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:source-paths</span> [<span class="keyword">..</span><span class="keyword">.</span>]
 <span class="symbol">:dependencies</span> [<span class="keyword">..</span><span class="keyword">.</span>]
 <span class="symbol">:cache-root</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">.shadow-cljs</span><span class="delimiter">&quot;</span></span>
 <span class="symbol">:builds</span> <span class="keyword">..</span><span class="keyword">.</span>}

<span class="comment">;; cache then goes to</span>
<span class="comment">;; .shadow-cljs/builds/app/dev/ana/cljs/core.cljs.cache.transit.json</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="closure-defines"><a class="anchor" href="#closure-defines"></a><a class="link" href="#closure-defines">6.5. クロージャの定義</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">your.app</span>)

(goog-define VERBOSE <span class="predefined-constant">false</span>)

(<span class="keyword">when</span> VERBOSE
  (<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="symbol">:target</span> <span class="symbol">:browser</span>
   <span class="keyword">..</span><span class="keyword">.</span>
   <span class="symbol">:modules</span> {<span class="symbol">:app</span> {<span class="symbol">:entries</span> [your.app]}}
   <span class="comment">;; to enable in development only</span>
   <span class="symbol">:dev</span> {<span class="symbol">:closure-defines</span> {your.app/VERBOSE <span class="predefined-constant">true</span>}}
   <span class="comment">;; to enable always</span>
   <span class="symbol">:closure-defines</span> {your.app/VERBOSE <span class="predefined-constant">true</span>}
   <span class="comment">;; you may also enable it for release as well</span>
   <span class="symbol">:release</span> {<span class="symbol">:closure-defines</span> {your.app/VERBOSE <span class="predefined-constant">true</span>}}
   }}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="compiler-options"><a class="anchor" href="#compiler-options"></a><a class="link" href="#compiler-options">6.6. コンパイラのオプション</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:dependencies</span> [<span class="keyword">..</span><span class="keyword">.</span>]
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="symbol">:target</span> <span class="symbol">:browser</span>
   <span class="keyword">..</span><span class="keyword">.</span>
   <span class="symbol">:compiler-options</span> {<span class="symbol">:fn-invoke-direct</span> <span class="predefined-constant">true</span>}}}}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="warnigs-as-errors"><a class="anchor" href="#warnigs-as-errors"></a><a class="link" href="#warnigs-as-errors">6.6.1. エラーとしてのワーニング</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="keyword">..</span><span class="keyword">.</span>
   <span class="symbol">:compiler-options</span> {<span class="symbol">:warnings-as-errors</span> <span class="predefined-constant">true</span>}}}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="keyword">..</span><span class="keyword">.</span>
   <span class="symbol">:compiler-options</span> {<span class="symbol">:warnings-as-errors</span> #{<span class="symbol">:undeclared-var</span>}}}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="keyword">..</span><span class="keyword">.</span>
   <span class="symbol">:compiler-options</span> {<span class="symbol">:warnings-as-errors</span> {<span class="symbol">:ignore</span> #{some.ns some.library.*}
                                           <span class="symbol">:warnings-types</span> #{<span class="symbol">:undeclared-var</span>}}}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_出力言語オプション"><a class="anchor" href="#_出力言語オプション"></a><a class="link" href="#_出力言語オプション">6.7. 出力言語オプション</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:script</span>
  {<span class="symbol">:target</span> <span class="symbol">:node-script</span>
   <span class="symbol">:main</span> foo.bar/main
   <span class="keyword">..</span><span class="keyword">.</span>
   <span class="symbol">:compiler-options</span> {<span class="symbol">:output-feature-set</span> <span class="symbol">:es7</span>}}}}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conditional_reading"><a class="anchor" href="#_conditional_reading"></a><a class="link" href="#_conditional_reading">6.8. Conditional Reading</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">my.awesome.component</span>
  (<span class="symbol">:require</span>
    [<span class="string"><span class="delimiter">&quot;</span><span class="content">react</span><span class="delimiter">&quot;</span></span> <span class="symbol">:as</span> react]
    [<span class="string"><span class="delimiter">&quot;</span><span class="content">codemirror</span><span class="delimiter">&quot;</span></span> <span class="symbol">:as</span> CodeMirror]))

<span class="comment">;; suppose you create a CodeMirror instance on some React :ref</span>
(<span class="keyword">defn</span> <span class="function">init-cm</span> [dom-node]
  (<span class="keyword">let</span> [cm (CodeMirror/fromTextArea dom-node <span class="error">#</span>js {<span class="keyword">..</span><span class="keyword">.</span>})]
    <span class="keyword">..</span><span class="keyword">.</span>))

<span class="keyword">..</span><span class="keyword">.</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">my.awesome.component</span>
 (<span class="symbol">:require</span>
   [<span class="string"><span class="delimiter">&quot;</span><span class="content">react</span><span class="delimiter">&quot;</span></span> <span class="symbol">:as</span> react]
   <span class="comment">;; NOTE: The order here matters. Only the first applicable</span>
   <span class="comment">;; branch is used. If :cljs is used first it will still be</span>
   <span class="comment">;; taken by the :server build</span>
   <span class="error">#</span>?@(<span class="symbol">:node</span> [[]]
       <span class="symbol">:cljs</span> [[<span class="string"><span class="delimiter">&quot;</span><span class="content">codemirror</span><span class="delimiter">&quot;</span></span> <span class="symbol">:as</span> CodeMirror]])))

<span class="error">#</span>?(<span class="symbol">:node</span> <span class="comment">;; node platform override</span>
   (<span class="keyword">defn</span> <span class="function">init-cm</span> [dom-node]
    <span class="symbol">:no-op</span>)
   <span class="symbol">:cljs</span> <span class="comment">;; default impl</span>
   (<span class="keyword">defn</span> <span class="function">init-cm</span> [dom-node]
     <span class="keyword">..</span><span class="keyword">.</span> actual impl <span class="keyword">..</span><span class="keyword">.</span>))

<span class="keyword">..</span><span class="keyword">.</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 <span class="comment">;; app build configured normally, no adjustments required</span>
 {<span class="symbol">:app</span>
  {<span class="symbol">:target</span> <span class="symbol">:browser</span>
   <span class="keyword">..</span><span class="keyword">.</span>}
  <span class="comment">;; for the server we add the :node reader feature</span>
  <span class="comment">;; it will then be used instead of the default :cljs</span>
  <span class="symbol">:server</span>
  {<span class="symbol">:target</span> <span class="symbol">:node-script</span>
   <span class="symbol">:compiler-options</span>
   {<span class="symbol">:reader-features</span> #{<span class="symbol">:node</span>}}}}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">my.awesome.component</span>
  (<span class="symbol">:require</span>
    [<span class="string"><span class="delimiter">&quot;</span><span class="content">react</span><span class="delimiter">&quot;</span></span> <span class="symbol">:as</span> react]))

<span class="comment">;; this will likely be removed as dead code if</span>
<span class="comment">;; its never actually called anywhere</span>

(<span class="keyword">defn</span> <span class="function">init-cm</span> [dom-node] <span class="symbol">:no-op</span>)
<span class="keyword">..</span><span class="keyword">.</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="config-merge"><a class="anchor" href="#config-merge"></a><a class="link" href="#config-merge">6.9. CLIからのオーバーライド</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="symbol">:target</span> <span class="symbol">:browser</span>
   <span class="symbol">:output-dir</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">public/js</span><span class="delimiter">&quot;</span></span>
   <span class="keyword">..</span><span class="keyword">.</span>}}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ shadow-cljs release app --config-merge '{:output-dir &quot;somewhere/else&quot;}'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ shadow-cljs release app --config-merge '{:closure-defines {your.app/DEBUG true}}'</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="shadow-env"><a class="anchor" href="#shadow-env"></a><a class="link" href="#shadow-env">6.10. 環境変数の使用</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="symbol">:target</span> <span class="symbol">:browser</span>
   <span class="symbol">:output-dir</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">public/js</span><span class="delimiter">&quot;</span></span>
   <span class="symbol">:closure-defines</span> {your.app/URL <span class="error">#</span>shadow/env <span class="string"><span class="delimiter">&quot;</span><span class="content">APP_URL</span><span class="delimiter">&quot;</span></span>}
   <span class="keyword">..</span><span class="keyword">.</span>}}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="error">#</span>shadow/env <span class="string"><span class="delimiter">&quot;</span><span class="content">APP_URL</span><span class="delimiter">&quot;</span></span>
<span class="error">#</span>shadow/env [<span class="string"><span class="delimiter">&quot;</span><span class="content">APP_URL</span><span class="delimiter">&quot;</span></span>]
<span class="comment">;; with default value, used if env variable is not set</span>
<span class="error">#</span>shadow/env [<span class="string"><span class="delimiter">&quot;</span><span class="content">APP_URL</span><span class="delimiter">&quot;</span></span> <span class="string"><span class="delimiter">&quot;</span><span class="content">default-value</span><span class="delimiter">&quot;</span></span>]
<span class="error">#</span>shadow/env [<span class="string"><span class="delimiter">&quot;</span><span class="content">APP_URL</span><span class="delimiter">&quot;</span></span> <span class="symbol">:default</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">default-value</span><span class="delimiter">&quot;</span></span>]
<span class="comment">;; turn PORT env into an integer, with default</span>
<span class="error">#</span>shadow/env [<span class="string"><span class="delimiter">&quot;</span><span class="content">PORT</span><span class="delimiter">&quot;</span></span> <span class="symbol">:as</span> <span class="symbol">:int</span> <span class="symbol">:default</span> <span class="integer">8080</span>]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="build-target-defaults"><a class="anchor" href="#build-target-defaults"></a><a class="link" href="#build-target-defaults">6.11. ビルドとターゲットのデフォルト</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:build-defaults</span>
 {<span class="symbol">:closure-defines</span>
   {your.app/VERBOSE <span class="predefined-constant">true</span>}}

 <span class="symbol">:target-defaults</span>
 {<span class="symbol">:browser</span>
   {<span class="symbol">:js-options</span>
     {<span class="symbol">:resolve</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">react</span><span class="delimiter">&quot;</span></span> {<span class="symbol">:target</span> <span class="symbol">:global</span>
                         <span class="symbol">:global</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">React</span><span class="delimiter">&quot;</span></span>}}}}}

 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="symbol">:target</span> <span class="symbol">:browser</span>
   <span class="keyword">..</span><span class="keyword">.</span>}}}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="target-browser"><a class="anchor" href="#target-browser"></a><a class="link" href="#target-browser">7. ブラウザを対象とする</a></h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:dependencies</span> [<span class="keyword">..</span><span class="keyword">.</span>]
 <span class="symbol">:source-paths</span> [<span class="keyword">..</span><span class="keyword">.</span>]

 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span> {<span class="symbol">:target</span> <span class="symbol">:browser</span>
        <span class="symbol">:output-dir</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">public/assets/app/js</span><span class="delimiter">&quot;</span></span>
        <span class="symbol">:asset-path</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/assets/app/js</span><span class="delimiter">&quot;</span></span>
        <span class="symbol">:modules</span> {<span class="symbol">:main</span> {<span class="symbol">:entries</span> [my.app]}}}]}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_出力設定"><a class="anchor" href="#_出力設定"></a><a class="link" href="#_出力設定">7.1. 出力設定</a></h3>

</div>
<div class="sect2">
<h3 id="_モジュール"><a class="anchor" href="#_モジュール"></a><a class="link" href="#_モジュール">7.2. モジュール</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span> {<span class="symbol">:target</span> <span class="symbol">:browser</span>
        <span class="symbol">:output-dir</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">public/js</span><span class="delimiter">&quot;</span></span>
        <span class="keyword">..</span><span class="keyword">.</span>
        <span class="symbol">:modules</span> {<span class="symbol">:main</span> {<span class="symbol">:entries</span> [my.app]}}}}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span> {<span class="symbol">:target</span> <span class="symbol">:browser</span>
        <span class="symbol">:output-dir</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">public/js</span><span class="delimiter">&quot;</span></span>
        <span class="keyword">..</span><span class="keyword">.</span>
        <span class="symbol">:modules</span> {<span class="symbol">:main</span> {<span class="symbol">:init-fn</span> my.app/init}}}}}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="CodeSplitting"><a class="anchor" href="#CodeSplitting"></a><a class="link" href="#CodeSplitting">7.3. コード・スプリッティング</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:output-dir</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">public/js</span><span class="delimiter">&quot;</span></span>
 <span class="symbol">:modules</span>
 {<span class="symbol">:shared</span>
  {<span class="symbol">:entries</span> [my.app.common]}
  <span class="symbol">:home</span>
  {<span class="symbol">:entries</span> [my.app.home]
   <span class="symbol">:depends-on</span> #{<span class="symbol">:shared</span>}}
  <span class="symbol">:login</span>
  {<span class="symbol">:entries</span> [my.app.login]
   <span class="symbol">:depends-on</span> #{<span class="symbol">:shared</span>}}
  <span class="symbol">:protected</span>
  {<span class="symbol">:entries</span> [my.app.protected]
   <span class="symbol">:depends-on</span> #{<span class="symbol">:shared</span>}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">.
└── public
    └── js
        ├── shared.js
        ├── home.js
        ├── login.js
        └── protected.js</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/js/shared.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/js/login.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_動的にコードを読み込む"><a class="anchor" href="#_動的にコードを読み込む"></a><a class="link" href="#_動的にコードを読み込む">7.3.1. 動的にコードを読み込む</a></h4>
<div class="sect4">
<h5 id="_shadow_cljsに組み込まれたloader_supportの使用"><a class="anchor" href="#_shadow_cljsに組み込まれたloader_supportの使用"></a><a class="link" href="#_shadow_cljsに組み込まれたloader_supportの使用">shadow-cljsに組み込まれたLoader Supportの使用</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
   {<span class="symbol">:app</span>
     {<span class="symbol">:target</span> <span class="symbol">:browser</span>
      <span class="keyword">..</span><span class="keyword">.</span>
      <span class="symbol">:module-loader</span> <span class="predefined-constant">true</span>
      <span class="symbol">:modules</span> {<span class="symbol">:main</span>  {<span class="symbol">:entries</span> [my.app]}
                <span class="symbol">:extra</span> {<span class="symbol">:entries</span> [my.app.extra]
                        <span class="symbol">:depends-on</span> #{<span class="symbol">:main</span>}}}}}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">my.app</span>
  (<span class="symbol">:require</span> [shadow.loader <span class="symbol">:as</span> loader]))

(<span class="keyword">defn</span> <span class="function">fn-to-call-on-load</span> []
  (js/console.log <span class="string"><span class="delimiter">&quot;</span><span class="content">extra loaded</span><span class="delimiter">&quot;</span></span>))

(<span class="keyword">defn</span> <span class="function">fn-to-call-on-error</span> []
  (js/console.log <span class="string"><span class="delimiter">&quot;</span><span class="content">extra load failed</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="comment">;; load returns a goog.async.Deferred, and can be used like a promise</span>
(<span class="keyword">-&gt;</span> (loader/load <span class="string"><span class="delimiter">&quot;</span><span class="content">extra</span><span class="delimiter">&quot;</span></span>)
    (<span class="keyword">.</span>then fn-to-call-on-load fn-to-call-on-error))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Loading many modules</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="comment">;; must be a JS array, also returns goog.async.Deferred</span>
(loader/load-many <span class="error">#</span>js [<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span> <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(loader/with-module <span class="string"><span class="delimiter">&quot;</span><span class="content">extra</span><span class="delimiter">&quot;</span></span> fn-to-call-on-load)</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_ローダーのコスト"><a class="anchor" href="#_ローダーのコスト"></a><a class="link" href="#_ローダーのコスト">ローダーのコスト</a></h6>

</div>
</div>
<div class="sect4">
<h5 id="_標準的なclojurescript_apiの使用"><a class="anchor" href="#_標準的なclojurescript_apiの使用"></a><a class="link" href="#_標準的なclojurescript_apiの使用">標準的なClojureScript APIの使用</a></h5>

</div>
</div>
</div>
<div class="sect2">
<h3 id="output-wrapper"><a class="anchor" href="#output-wrapper"></a><a class="link" href="#output-wrapper">7.4. アウトプット・ラッパー</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:target</span> <span class="symbol">:browser</span>
  <span class="keyword">..</span><span class="keyword">.</span>
  <span class="symbol">:compiler-options</span>
  {<span class="symbol">:output-wrapper</span> <span class="predefined-constant">true</span>
   <span class="symbol">:rename-prefix-namespace</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">MY_APP</span><span class="delimiter">&quot;</span></span>}}}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ウェブワーカー"><a class="anchor" href="#_ウェブワーカー"></a><a class="link" href="#_ウェブワーカー">7.5. ウェブワーカー</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="symbol">:target</span> <span class="symbol">:browser</span>
   <span class="symbol">:output-dir</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">public/js</span><span class="delimiter">&quot;</span></span>
   <span class="symbol">:asset-path</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/js</span><span class="delimiter">&quot;</span></span>
   <span class="keyword">..</span><span class="keyword">.</span>
   <span class="symbol">:modules</span>
   {<span class="symbol">:shared</span>
    {<span class="symbol">:entries</span> []}
    <span class="symbol">:main</span>
    {<span class="symbol">:init-fn</span> my.app/init
     <span class="symbol">:depends-on</span> #{<span class="symbol">:shared</span>}}
    <span class="symbol">:worker</span>
    {<span class="symbol">:init-fn</span> my.app.worker/init
     <span class="symbol">:depends-on</span> #{<span class="symbol">:shared</span>}
     <span class="symbol">:web-worker</span> <span class="predefined-constant">true</span>}}
   }}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">my.app.worker</span>)

(<span class="keyword">defn</span> <span class="function">init</span> []
  (js/self.addEventListener <span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>
    (<span class="keyword">fn</span> [^js e]
      (js/postMessage (<span class="keyword">..</span> e -data)))))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">my.app</span>)

(<span class="keyword">defn</span> <span class="function">init</span> []
  (<span class="keyword">let</span> [worker (js/Worker. <span class="string"><span class="delimiter">&quot;</span><span class="content">/js/worker.js</span><span class="delimiter">&quot;</span></span>)]
    (<span class="keyword">..</span> worker (addEventListener <span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span> (<span class="keyword">fn</span> [e] (js/console.log e))))
    (<span class="keyword">..</span> worker (postMessage <span class="string"><span class="delimiter">&quot;</span><span class="content">hello world</span><span class="delimiter">&quot;</span></span>))))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">&lt;script src<span class="keyword">=</span><span class="string"><span class="delimiter">&quot;</span><span class="content">/js/shared.js</span><span class="delimiter">&quot;</span></span>&gt;&lt;/script&gt;
&lt;script src<span class="keyword">=</span><span class="string"><span class="delimiter">&quot;</span><span class="content">/js/main.js</span><span class="delimiter">&quot;</span></span>&gt;&lt;/script&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_キャッシュ可能な出力"><a class="anchor" href="#_キャッシュ可能な出力"></a><a class="link" href="#_キャッシュ可能な出力">7.6. キャッシュ可能な出力</a></h3>
<div class="sect3">
<h4 id="release-version"><a class="anchor" href="#release-version"></a><a class="link" href="#release-version">7.6.1. リリースバージョン</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">shadow-cljs release app --config-merge '{<span class="symbol">:release-version</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">v1</span><span class="delimiter">&quot;</span></span>}'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
   {<span class="symbol">:app</span>
     {<span class="symbol">:target</span> <span class="symbol">:browser</span>
      <span class="keyword">..</span><span class="keyword">.</span>
      <span class="symbol">:output-dir</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">public/js</span><span class="delimiter">&quot;</span></span>
      <span class="symbol">:asset-path</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/js</span><span class="delimiter">&quot;</span></span>
      <span class="symbol">:modules</span> {<span class="symbol">:main</span>  {<span class="symbol">:entries</span> [my.app]}
                <span class="symbol">:extra</span> {<span class="symbol">:entries</span> [my.app.extra]
                        <span class="symbol">:depends-on</span> #{<span class="symbol">:main</span>}}}}}}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="NameHashing"><a class="anchor" href="#NameHashing"></a><a class="link" href="#NameHashing">7.6.2. フィンガープリント・ハッシュを使ったファイル名</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
   {<span class="symbol">:app</span>
     {<span class="symbol">:target</span> <span class="symbol">:browser</span>
      <span class="keyword">..</span><span class="keyword">.</span>
      <span class="symbol">:output-dir</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">public/js</span><span class="delimiter">&quot;</span></span>
      <span class="symbol">:asset-path</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/js</span><span class="delimiter">&quot;</span></span>
      <span class="symbol">:module-hash-names</span> <span class="predefined-constant">true</span>
      <span class="symbol">:modules</span> {<span class="symbol">:main</span>  {<span class="symbol">:entries</span> [my.app]}
                <span class="symbol">:extra</span> {<span class="symbol">:entries</span> [my.app.extra]
                        <span class="symbol">:depends-on</span> #{<span class="symbol">:main</span>}}}}}}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="BrowserManifest"><a class="anchor" href="#BrowserManifest"></a><a class="link" href="#BrowserManifest">7.7. 出力マニフェスト</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">[{<span class="symbol">:module-id</span> <span class="symbol">:common</span>,
  <span class="symbol">:name</span> <span class="symbol">:common</span>,
  <span class="symbol">:output-name</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">common.15D142F7841E2838B46283EA558634EE.js</span><span class="delimiter">&quot;</span></span>,
  <span class="symbol">:entries</span> [<span class="keyword">..</span><span class="keyword">.</span>],
  <span class="symbol">:depends-on</span> #{},
  <span class="symbol">:sources</span> [<span class="keyword">..</span><span class="keyword">.</span>]}
 {<span class="symbol">:module-id</span> <span class="symbol">:page-a</span>,
  <span class="symbol">:name</span> <span class="symbol">:page-a</span>,
  <span class="symbol">:output-name</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">page-a.D8844E305644135CBD5CBCF7E359168A.js</span><span class="delimiter">&quot;</span></span>,
  <span class="symbol">:entries</span> [<span class="keyword">..</span><span class="keyword">.</span>],
  <span class="symbol">:depends-on</span> #{<span class="symbol">:common</span>},
  <span class="symbol">:sources</span> [<span class="keyword">..</span><span class="keyword">.</span>]}
 <span class="keyword">..</span><span class="keyword">.</span>]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
   {<span class="symbol">:app</span>
     {<span class="symbol">:target</span> <span class="symbol">:browser</span>
      <span class="keyword">..</span><span class="keyword">.</span>
      <span class="symbol">:build-options</span> {<span class="symbol">:manifest-name</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">manifest.json</span><span class="delimiter">&quot;</span></span>}
      <span class="symbol">:modules</span> {<span class="symbol">:main</span>  {<span class="symbol">:entries</span> [my.app]}
                <span class="symbol">:extra</span> {<span class="symbol">:entries</span> [my.app.extra]
                        <span class="symbol">:depends-on</span> #{<span class="symbol">:main</span>}}}}}}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_開発サポート"><a class="anchor" href="#_開発サポート"></a><a class="link" href="#_開発サポート">7.8. 開発サポート</a></h3>
<div class="sect3">
<h4 id="hud"><a class="anchor" href="#hud"></a><a class="link" href="#hud">7.8.1. ヘッドアップディスプレイ（HUD）</a></h4>
<div class="sect4">
<h5 id="open-file-command"><a class="anchor" href="#open-file-command"></a><a class="link" href="#open-file-command">ファイルを開く</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:open-file-command</span>
 [<span class="string"><span class="delimiter">&quot;</span><span class="content">idea</span><span class="delimiter">&quot;</span></span> <span class="symbol">:pwd</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">--line</span><span class="delimiter">&quot;</span></span> <span class="symbol">:line</span> <span class="symbol">:file</span>]}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ idea /path/to/project-root --line 3 /path/to/project-root/src/main/demo/foo.cljs</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:open-file-command</span>
 [<span class="string"><span class="delimiter">&quot;</span><span class="content">emacsclient</span><span class="delimiter">&quot;</span></span> <span class="string"><span class="delimiter">&quot;</span><span class="content">-n</span><span class="delimiter">&quot;</span></span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">+%s:%s</span><span class="delimiter">&quot;</span></span> <span class="symbol">:line</span> <span class="symbol">:column</span>] <span class="symbol">:file</span>]}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ emacsclient -n +3:1 /path/to/project-root/src/main/demo/foo.cljs</code></pre>
</div>
</div>
<div class="dlist Horizontal">
<dl>
<dt><code>:pwd</code></dt>
<dd>
<p>Process Working Directory (aka project root)</p>
</dd>
<dt><code>:file</code></dt>
<dd>
<p>Absolute File Path</p>
</dd>
<dt><code>:line</code></dt>
<dd>
<p>Line Number of Warning/Error</p>
</dd>
<dt><code>:column</code></dt>
<dd>
<p>Column Number</p>
</dd>
<dt><code>:wsl-file</code></dt>
<dd>
<p>Translated WSL file path. Useful when running <code>shadow-cljs</code> via WSL Bash. Translates a <code>/mnt/c/Users/someone/code/project/src/main/demo/foo.cljs</code> path into <code>C:\Users...</code></p>
</dd>
<dt><code>:wsl-pwd</code></dt>
<dd>
<p>Translated <code>:pwd</code></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_css_リローディング"><a class="anchor" href="#_css_リローディング"></a><a class="link" href="#_css_リローディング">7.8.2. CSS リローディング</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;link</span> <span class="attribute-name">rel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stylesheet</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/css/main.css</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">[<span class="symbol">:link</span> {<span class="symbol">:rel</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">stylesheet</span><span class="delimiter">&quot;</span></span> <span class="symbol">:href</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/css/main.css</span><span class="delimiter">&quot;</span></span>}]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="symbol">:dev-http</span> {<span class="integer">8000</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
    {<span class="symbol">:builds</span>
      {<span class="symbol">:app</span> {<span class="keyword">..</span><span class="keyword">.</span>
             <span class="symbol">:devtools</span> {<span class="symbol">:watch-dir</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span>}}}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 {<span class="symbol">:builds</span>
  {<span class="symbol">:app</span>
   {<span class="keyword">..</span><span class="keyword">.</span>
    <span class="symbol">:devtools</span> {<span class="symbol">:watch-dir</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span>
               <span class="symbol">:watch-path</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/foo</span><span class="delimiter">&quot;</span></span>}}}}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proxy-support"><a class="anchor" href="#proxy-support"></a><a class="link" href="#proxy-support">7.8.3. プロキシサポート</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span> {<span class="keyword">..</span><span class="keyword">.</span>
        <span class="symbol">:devtools</span> {<span class="symbol">:before-load</span>  my.app/stop
                   <span class="symbol">:after-load</span>   my.app/start
                   <span class="symbol">:devtools-url</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">https://some.host/shadow-cljs</span><span class="delimiter">&quot;</span></span>
                   <span class="keyword">..</span><span class="keyword">.</span>}}}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">https://some.host/shadow-cljs/ws/foo/bar?asdf</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">http<span class="symbol">://localhost</span><span class="error">:</span><span class="integer">9630</span>/foo/bar?asdf</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="target-react-native"><a class="anchor" href="#target-react-native"></a><a class="link" href="#target-react-native">8. React Nativeをターゲットにする</a></h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:source-paths</span> [<span class="keyword">..</span><span class="keyword">.</span>]
 <span class="symbol">:dependencies</span> [<span class="keyword">..</span><span class="keyword">.</span>]
 <span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="symbol">:target</span> <span class="symbol">:react-native</span>
   <span class="symbol">:init-fn</span> demo.app/init
   <span class="symbol">:output-dir</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">app</span><span class="delimiter">&quot;</span></span>}}}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_react_native"><a class="anchor" href="#_react_native"></a><a class="link" href="#_react_native">8.1. React Native</a></h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/thheller/reagent-react-native" class="bare">https://github.com/thheller/reagent-react-native</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_expo"><a class="anchor" href="#_expo"></a><a class="link" href="#_expo">8.2. Expo</a></h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/thheller/fulcro-expo" class="bare">https://github.com/thheller/fulcro-expo</a></p>
</li>
<li>
<p><a href="https://github.com/thheller/reagent-expo" class="bare">https://github.com/thheller/reagent-expo</a></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{
  <span class="string"><span class="delimiter">&quot;</span><span class="content">expo</span><span class="delimiter">&quot;</span></span><span class="error">:</span> {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="error">:</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">slug</span><span class="delimiter">&quot;</span></span><span class="error">:</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">reagent-expo</span><span class="delimiter">&quot;</span></span>,
    <span class="keyword">..</span><span class="keyword">.</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">entryPoint</span><span class="delimiter">&quot;</span></span><span class="error">:</span><span class="string"><span class="delimiter">&quot;</span><span class="content">./app/index.js</span><span class="delimiter">&quot;</span></span>,
    <span class="keyword">..</span><span class="keyword">.</span>
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">defn</span> <span class="function">start</span>
  {<span class="symbol">:dev/after-load</span> <span class="predefined-constant">true</span>}
  []
  (expo/render-root (r/as-element [root])))

(<span class="keyword">defn</span> <span class="function">init</span> []
  (start))</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="target-node"><a class="anchor" href="#target-node"></a><a class="link" href="#target-node">9. node.jsを対象とする</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>スタンドアロンのスクリプトとして使用するためのコードや、ライブラリとして使用するためのコードを生成する機能が組み込まれています。
スクリプトとして使用するためのコードや、ライブラリとして使用するためのコードの生成がサポートされています。コード生成に必要な基本設定については
設定ファイルに必要な基本的な設定については、<a href="#config">共通設定</a>のセクションを参照してください。
設定ファイルに必要な基本的な設定については</p>
</div>
<div class="sect2">
<h3 id="target-node-script"><a class="anchor" href="#target-node-script"></a><a class="link" href="#target-node-script">9.1. node.js のスクリプト</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">demo.script</span>)

(<span class="keyword">defn</span> <span class="function">main</span> [&amp; cli-args]
  (<span class="keyword">prn</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">hello world</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_ビルドオプション"><a class="anchor" href="#_ビルドオプション"></a><a class="link" href="#_ビルドオプション">9.1.1. ビルドオプション</a></h4>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>:main</code>
</td>
<td class="hdlist2">
<p>(required). The namespace-qualified symbol of your script&#8217;s entry point function.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:output-to</code>
</td>
<td class="hdlist2">
<p>(required). The path and filename for the generated script.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:output-dir</code>
</td>
<td class="hdlist2">
<p>(optional). The path for supporting files in development mode. Defaults to a cache directory.</p>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:source-paths</span> [<span class="keyword">..</span><span class="keyword">.</span>]
 <span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:script</span>
  {<span class="symbol">:target</span> <span class="symbol">:node-script</span>
   <span class="symbol">:main</span> demo.script/main
   <span class="symbol">:output-to</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">out/demo-script/script.js</span><span class="delimiter">&quot;</span></span>}}}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="NodeHotCodeReload"><a class="anchor" href="#NodeHotCodeReload"></a><a class="link" href="#NodeHotCodeReload">9.1.2. ホットコードリロード</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">demo.script</span>
  (<span class="symbol">:require</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">http</span><span class="delimiter">&quot;</span></span> <span class="symbol">:as</span> http]))

(<span class="keyword">defn</span> <span class="function">request-handler</span> [req res]
  (<span class="keyword">.</span>end res <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>))

<span class="comment">; a place to hang onto the server so we can stop/start it</span>
(<span class="keyword">defonce</span> <span class="function">server-ref</span>
  (volatile! <span class="predefined-constant">nil</span>))

(<span class="keyword">defn</span> <span class="function">main</span> [&amp; args]
  (js/console.log <span class="string"><span class="delimiter">&quot;</span><span class="content">starting server</span><span class="delimiter">&quot;</span></span>)
  (<span class="keyword">let</span> [server (http/createServer #(request-handler %1 %2))]

    (<span class="keyword">.</span>listen server <span class="integer">3000</span>
      (<span class="keyword">fn</span> [err]
        (<span class="keyword">if</span> err
          (js/console.error <span class="string"><span class="delimiter">&quot;</span><span class="content">server start failed</span><span class="delimiter">&quot;</span></span>)
          (js/console.info <span class="string"><span class="delimiter">&quot;</span><span class="content">http server running</span><span class="delimiter">&quot;</span></span>))
        ))

    (vreset! server-ref server)))

(<span class="keyword">defn</span> <span class="function">start</span>
  <span class="string"><span class="delimiter">&quot;</span><span class="content">Hook to start. Also used as a hook for hot code reload.</span><span class="delimiter">&quot;</span></span>
  []
  (js/console.warn <span class="string"><span class="delimiter">&quot;</span><span class="content">start called</span><span class="delimiter">&quot;</span></span>)
  (main))

(<span class="keyword">defn</span> <span class="function">stop</span>
  <span class="string"><span class="delimiter">&quot;</span><span class="content">Hot code reload hook to shut down resources so hot code reload can work</span><span class="delimiter">&quot;</span></span>
  [done]
  (js/console.warn <span class="string"><span class="delimiter">&quot;</span><span class="content">stop called</span><span class="delimiter">&quot;</span></span>)
  (when-some [srv @server-ref]
    (<span class="keyword">.</span>close srv
      (<span class="keyword">fn</span> [err]
        (js/console.log <span class="string"><span class="delimiter">&quot;</span><span class="content">stop completed</span><span class="delimiter">&quot;</span></span> err)
        (done)))))

(js/console.log <span class="string"><span class="delimiter">&quot;</span><span class="content">__filename</span><span class="delimiter">&quot;</span></span> js/__filename)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
   { <span class="symbol">:script</span> {<span class="keyword">..</span><span class="keyword">.</span> as before

              <span class="comment">; add in reload hooks</span>
              <span class="symbol">:devtools</span> {<span class="symbol">:before-load-async</span> demo.script/stop
                         <span class="symbol">:after-load</span> demo.script/start}}}}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="target-node-library"><a class="anchor" href="#target-node-library"></a><a class="link" href="#target-node-library">9.2. node.js ライブラリ</a></h3>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>:target</code>
</td>
<td class="hdlist2">
<p>Use :node-library</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:output-to</code>
</td>
<td class="hdlist2">
<p>(required). The path and filename for the generated library.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:output-dir</code>
</td>
<td class="hdlist2">
<p>(optional). The path for supporting files in development mode. Defaults to a cache directory.</p>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_単一で静的な_デフォルト_エクスポート"><a class="anchor" href="#_単一で静的な_デフォルト_エクスポート"></a><a class="link" href="#_単一で静的な_デフォルト_エクスポート">9.2.1. 単一で静的な "デフォルト" エクスポート</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span> {<span class="symbol">:lib</span> {<span class="symbol">:output-to</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">lib.js</span><span class="delimiter">&quot;</span></span>
                <span class="symbol">:exports-var</span> demo.ns/f
                <span class="keyword">..</span><span class="keyword">.</span>}}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">demo.ns</span>)

(<span class="keyword">defn</span> <span class="function">f</span> [<span class="keyword">..</span><span class="keyword">.</span>] <span class="keyword">..</span><span class="keyword">.</span>)
<span class="comment">;; OR</span>
(<span class="keyword">def</span> <span class="function">f</span> <span class="error">#</span>js {<span class="symbol">:foo</span> <span class="keyword">..</span><span class="keyword">.</span>})</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ node
&gt; var f = require('./lib.js');
f(); // the actual demo.ns/f function</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_複数の静的な名前付きエクスポート"><a class="anchor" href="#_複数の静的な名前付きエクスポート"></a><a class="link" href="#_複数の静的な名前付きエクスポート">9.2.2. 複数の静的な名前付きエクスポート</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span> {<span class="symbol">:lib</span> {<span class="symbol">:exports</span> {<span class="symbol">:g</span>       demo.ns/f
                          <span class="symbol">:h</span>       other.ns/thing
                          <span class="symbol">:ns/ok?</span>  another.ns/ok?}
                <span class="keyword">..</span><span class="keyword">.</span>}}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ node
&gt; var lib = require('./lib.js');
lib.g(); // call demo-ns/f
lib[&quot;ok?&quot;](); // call another-ns/ok?</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">def</span> <span class="function">exports</span> <span class="error">#</span>js {<span class="symbol">:g</span> f
                  <span class="keyword">..</span><span class="keyword">.</span>})</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dynamic_exports"><a class="anchor" href="#_dynamic_exports"></a><a class="link" href="#_dynamic_exports">9.2.3. "Dynamic" exports</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">demo.ns</span>
  (<span class="symbol">:require</span> [demo.other <span class="symbol">:as</span> other]))

(<span class="keyword">defn</span> <span class="function">generate-exports</span> []
  <span class="error">#</span>js {<span class="symbol">:hello</span> hello
       <span class="symbol">:foo</span> other/foo})</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span> {<span class="symbol">:lib</span> {<span class="symbol">:exports-fn</span> demo.ns/generate-exports
                <span class="keyword">..</span><span class="keyword">.</span>}}}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_完全な例"><a class="anchor" href="#_完全な例"></a><a class="link" href="#_完全な例">9.2.4. 完全な例</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">demo.lib</span>)

(<span class="keyword">defn</span> <span class="function">hello</span> []
  (<span class="keyword">prn</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>)
  <span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span> {<span class="symbol">:library</span> {<span class="symbol">:target</span>    <span class="symbol">:node-library</span>
                    <span class="symbol">:output-to</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">out/demo-library/lib.js</span><span class="delimiter">&quot;</span></span>
                    <span class="symbol">:exports</span>   {<span class="symbol">:hello</span> demo.lib/hello}}}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">$ cd out/demo-library
$ node
<span class="keyword">&gt;</span> <span class="keyword">var</span> x <span class="keyword">=</span> <span class="keyword">require</span>('<span class="keyword">.</span>/lib')<span class="comment">;</span>
undefined
<span class="keyword">&gt;</span> x.hello()
hello
'hello'</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_npm_パッケージの作成"><a class="anchor" href="#_npm_パッケージの作成"></a><a class="link" href="#_npm_パッケージの作成">9.3. npm パッケージの作成</a></h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="target-npm-module"><a class="anchor" href="#target-npm-module"></a><a class="link" href="#target-npm-module">10. JSエコシステムへの組み込み&#8201;&#8212;&#8201;<code>:npm-module</code> ターゲット</a></h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="target-npm-module"><a class="anchor" href="#target-npm-module"></a><a class="link" href="#target-npm-module">11. JSエコシステムへの組み込み - :npm-module ターゲット</a></h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:code</span>
  {<span class="symbol">:target</span> <span class="symbol">:npm-module</span>
   <span class="symbol">:entries</span> [demo.foo]}}}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_optimizations"><a class="anchor" href="#_working_with_optimizations"></a><a class="link" href="#_working_with_optimizations">11.1. Working with Optimizations</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">demo.foo</span>)

(<span class="keyword">def</span> ^<span class="symbol">:export</span> foo <span class="float">5.662</span>)

(<span class="keyword">defn</span> ^<span class="symbol">:export</span> bar [] <span class="keyword">..</span><span class="keyword">.</span>)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">var</span> <span class="keyword">ns</span> <span class="namespace">=</span> <span class="keyword">require</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">shadow-cljs/demo.foo</span><span class="delimiter">&quot;</span></span>)<span class="comment">;</span>

ns.foo<span class="comment">;</span>
ns.bar()<span class="comment">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_テスト"><a class="anchor" href="#_テスト"></a><a class="link" href="#_テスト">12. テスト</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>shadow-cljs</code> は、テストの構築を少しでも簡単にするために、いくつかのユーティリティターゲットを提供しています。</p>
</div>
<div class="paragraph">
<p>すべてのテストターゲットはテストランナーを生成し、設定可能な <code>:ns-regexp</code> にマッチするすべての名前空間を自動的に追加します。デフォルトのテストランナーは <code>cljs.test</code> 用に作られていますが、他のテストフレームワークを使いたい場合は、カスタムランナーを作ることができます。</p>
</div>
<div class="paragraph">
<p>デフォルトの <code>:ns-regexp</code> は <code>"-test$"</code> なので、最初のテストは以下のようになります。</p>
</div>
<div class="listingblock">
<div class="title">ファイル： <code>src/test/demo/app_test.cljs</code>.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">demo.app-test</span>
  (<span class="symbol">:require</span> [cljs.test <span class="symbol">:refer</span> (deftest is)]))

(deftest a-failing-test
  (is (<span class="keyword">=</span> <span class="integer">1</span> <span class="integer">2</span>)))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Clojureの世界では、テストファイルをそれぞれのソースパスに置いておくのが一般的なので、上記の例では、<code>shadow-cljs.edn`の設定で</code>:source-paths <code class=""src/main" "src/test"">を設定していると仮定しています。通常のアプリのコードは `src/main</code> に入り、テストは <code>src/test</code> に入ります。ただし、これはオプションで、すべてを`src`に置いて、`:source-paths ["src"]`を使うだけでも全く問題ありません。</p>
</div>
<div class="sect2">
<h3 id="_node_js_におけるテスト_a_id_target_node_test_a"><a class="anchor" href="#_node_js_におけるテスト_a_id_target_node_test_a"></a><a class="link" href="#_node_js_におけるテスト_a_id_target_node_test_a">12.1. node.js におけるテスト　<a id="target-node-test"></a></a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:test</span>
  {<span class="symbol">:target</span>    <span class="symbol">:node-test</span>
   <span class="symbol">:output-to</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">out/node-tests.js</span><span class="delimiter">&quot;</span></span>
   <span class="symbol">:ns-regexp</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">-spec$</span><span class="delimiter">&quot;</span></span>
   <span class="symbol">:autorun</span>   <span class="predefined-constant">true</span>}}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ shadow-cljs compile test
# or
$ shadow-cljs release test

# run tests manually, :autorun will do this automatically
$ node out/node-tests.js

# compile &amp; test combined
$ shadow-cljs compile test &amp;&amp; node out/node-tests.js</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="target-browser-test"><a class="anchor" href="#target-browser-test"></a><a class="link" href="#target-browser-test">12.2. ブラウザにおけるテスト</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span> {<span class="symbol">:test</span>     {<span class="symbol">:target</span>    <span class="symbol">:browser-test</span>
                     <span class="symbol">:test-dir</span>  <span class="string"><span class="delimiter">&quot;</span><span class="content">resources/public/js/test</span><span class="delimiter">&quot;</span></span>
                     <span class="symbol">:ns-regexp</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">-spec$</span><span class="delimiter">&quot;</span></span>
                     <span class="symbol">:runner-ns</span> tests.client-test-main
                     <span class="symbol">:devtools</span>  {<span class="symbol">:http-port</span>          <span class="integer">8021</span>
                                 <span class="symbol">:http-root</span>          <span class="string"><span class="delimiter">&quot;</span><span class="content">resources/public/js/test</span><span class="delimiter">&quot;</span></span>}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">tests.client-test-main</span>)

(<span class="keyword">defn</span> <span class="function">start</span> []
  <span class="keyword">..</span><span class="keyword">.</span> run the tests.<span class="keyword">..</span>)

(<span class="keyword">defn</span> <span class="function">stop</span> [done]
  <span class="comment">; tests can be async. You must call done so that the runner knows you actually finished</span>
  (done))

(<span class="keyword">defn</span> ^<span class="symbol">:export</span> init []
  (start))</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_test_dir_に生成された出力"><a class="anchor" href="#_test_dir_に生成された出力"></a><a class="link" href="#_test_dir_に生成された出力">12.2.1. :test-dir に生成された出力</a></h4>

</div>
</div>
<div class="sect2">
<h3 id="target-karma"><a class="anchor" href="#target-karma"></a><a class="link" href="#target-karma">12.3. 継続的インテグレーションのためにテストをKarmaにターゲットする</a></h3>
<div class="sect3">
<h4 id="_karmaのインストール"><a class="anchor" href="#_karmaのインストール"></a><a class="link" href="#_karmaのインストール">12.3.1. Karmaのインストール</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">CITests</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0.0</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Testing</span><span class="delimiter">&quot;</span></span>,
  <span class="error">.</span><span class="error">.</span><span class="error">.</span>
  <span class="key"><span class="delimiter">&quot;</span><span class="content">devDependencies</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">karma</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">^2.0.0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">karma-chrome-launcher</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">^2.2.0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">karma-cljs-test</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">^0.1.0</span><span class="delimiter">&quot;</span></span>,
    <span class="error">.</span><span class="error">.</span><span class="error">.</span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">author</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">license</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">MIT</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_build"><a class="anchor" href="#_build"></a><a class="link" href="#_build">12.3.2. Build</a></h4>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>:target</code>
</td>
<td class="hdlist2">
<p><code>:karma</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:output-to</code>
</td>
<td class="hdlist2">
<p>A path/filename for the js file.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:ns-regexp</code>
</td>
<td class="hdlist2">
<p>(optional) A regex to match the test namespaces, defaults to "-test$</p>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:ci</span>
  {<span class="symbol">:target</span> <span class="symbol">:karma</span>
   <span class="symbol">:output-to</span>  <span class="string"><span class="delimiter">&quot;</span><span class="content">target/ci.js</span><span class="delimiter">&quot;</span></span>
   <span class="symbol">:ns-regexp</span>  <span class="string"><span class="delimiter">&quot;</span><span class="content">-spec$</span><span class="delimiter">&quot;</span></span>}}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">module.<span class="function">exports</span> = <span class="keyword">function</span> (config) {
    config.set({
        <span class="key">browsers</span>: [<span class="string"><span class="delimiter">'</span><span class="content">ChromeHeadless</span><span class="delimiter">'</span></span>],
        <span class="comment">// The directory where the output file lives</span>
        <span class="key">basePath</span>: <span class="string"><span class="delimiter">'</span><span class="content">target</span><span class="delimiter">'</span></span>,
        <span class="comment">// The file itself</span>
        <span class="key">files</span>: [<span class="string"><span class="delimiter">'</span><span class="content">ci.js</span><span class="delimiter">'</span></span>],
        <span class="key">frameworks</span>: [<span class="string"><span class="delimiter">'</span><span class="content">cljs-test</span><span class="delimiter">'</span></span>],
        <span class="key">plugins</span>: [<span class="string"><span class="delimiter">'</span><span class="content">karma-cljs-test</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">karma-chrome-launcher</span><span class="delimiter">'</span></span>],
        <span class="key">colors</span>: <span class="predefined-constant">true</span>,
        <span class="key">logLevel</span>: config.LOG_INFO,
        <span class="key">client</span>: {
            <span class="key">args</span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">shadow.test.karma.init</span><span class="delimiter">&quot;</span></span>],
            <span class="key">singleRun</span>: <span class="predefined-constant">true</span>
        }
    })
};</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ shadow-cljs compile ci
$ karma start --single-run
12 01 2018 01:19:24.222:INFO [karma]: Karma v2.0.0 server started at http://0.0.0.0:9876/
12 01 2018 01:19:24.224:INFO [launcher]: Launching browser ChromeHeadless with unlimited concurrency
12 01 2018 01:19:24.231:INFO [launcher]: Starting browser ChromeHeadless
12 01 2018 01:19:24.478:INFO [HeadlessChrome 0.0.0 (Mac OS X 10.12.6)]: Connected on socket TcfrjxVKmx7xN6enAAAA with id 85554456
LOG: 'Testing boo.sample-spec'
HeadlessChrome 0.0.0 (Mac OS X 10.12.6): Executed 1 of 1 SUCCESS (0.007 secs / 0.002 secs)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="js-deps"><a class="anchor" href="#js-deps"></a><a class="link" href="#js-deps">13. JavaScript との統合</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="npm"><a class="anchor" href="#npm"></a><a class="link" href="#npm">13.1. NPM</a></h3>
<div class="sect3">
<h4 id="_npmパッケージの使用"><a class="anchor" href="#_npmパッケージの使用"></a><a class="link" href="#_npmパッケージの使用">13.1.1. npmパッケージの使用</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js"><span class="keyword">var</span> react = require(<span class="string"><span class="delimiter">&quot;</span><span class="content">react</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">my.app</span>
  (<span class="symbol">:require</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">react</span><span class="delimiter">&quot;</span></span> <span class="symbol">:as</span> react]))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(react/createElement <span class="string"><span class="delimiter">&quot;</span><span class="content">div</span><span class="delimiter">&quot;</span></span> <span class="predefined-constant">nil</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">hello world</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ES6 Import</th>
<th class="tableblock halign-left valign-top">CLJS Require</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>import defaultExport from "module-name";</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(:require ["module-name" :default defaultExport])</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>import * as name from "module-name";</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(:require ["module-name" :as name])</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>import { export } from "module-name";</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(:require ["module-name" :refer (export)])</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>import { export as alias } from "module-name";</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(:require ["module-name" :rename {export alias}])</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>import { export1 , export2 } from "module-name";</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(:require ["module-name" :refer (export1 export2)])</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>import { export1 , export2 as alias2 , [&#8230;&#8203;] } from "module-name";</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(:require ["module-name" :refer (export1) :rename {export2 alias2}])</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>import defaultExport, { export [ , [&#8230;&#8203;] ] } from "module-name";</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(:require ["module-name" :refer (export) :default defaultExport])</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>import defaultExport, * as name from "module-name";</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(:require ["module-name" :as name :default defaultExport])</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>import "module-name";</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(:require ["module-name"])</code></p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js"><span class="comment">// You can import any component you want as a named export from 'react-virtualized', eg</span>
<span class="reserved">import</span> { Column, Table } from <span class="string"><span class="delimiter">'</span><span class="content">react-virtualized</span><span class="delimiter">'</span></span>

<span class="comment">// But if you only use a few react-virtualized components,</span>
<span class="comment">// And you're concerned about increasing your application's bundle size,</span>
<span class="comment">// You can directly import only the components you need, like so:</span>
<span class="reserved">import</span> AutoSizer from <span class="string"><span class="delimiter">'</span><span class="content">react-virtualized/dist/commonjs/AutoSizer</span><span class="delimiter">'</span></span>
<span class="reserved">import</span> List from <span class="string"><span class="delimiter">'</span><span class="content">react-virtualized/dist/commonjs/List</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">my-ns</span>
  <span class="comment">;; all</span>
  (<span class="symbol">:require</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">react-virtualized</span><span class="delimiter">&quot;</span></span> <span class="symbol">:refer</span> (Column Table)])
  <span class="comment">;; OR one by one</span>
  (<span class="symbol">:require</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">react-virtualized/dist/commonjs/AutoSizer</span><span class="delimiter">&quot;</span></span> <span class="symbol">:default</span> virtual-auto-sizer]
            [<span class="string"><span class="delimiter">&quot;</span><span class="content">react-virtualized/dist/commonjs/List</span><span class="delimiter">&quot;</span></span> <span class="symbol">:default</span> virtual-list]))</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_概要_default_exports"><a class="anchor" href="#_概要_default_exports"></a><a class="link" href="#_概要_default_exports">概要 :default Exports</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">$ shadow-cljs browser-repl (<span class="keyword">or</span> node-repl)
<span class="keyword">..</span><span class="keyword">.</span>
[<span class="integer">1</span><span class="error">:</span><span class="integer">1</span>]~cljs.user=&gt; (<span class="keyword">require</span> '[<span class="string"><span class="delimiter">&quot;</span><span class="content">react-tooltip</span><span class="delimiter">&quot;</span></span> <span class="symbol">:as</span> x])
<span class="predefined-constant">nil</span>
[<span class="integer">1</span><span class="error">:</span><span class="integer">1</span>]~cljs.user=&gt; x
<span class="error">#</span>object[e]
[<span class="integer">1</span><span class="error">:</span><span class="integer">1</span>]~cljs.user=&gt; (goog/typeOf x)
<span class="string"><span class="delimiter">&quot;</span><span class="content">function</span><span class="delimiter">&quot;</span></span>
[<span class="integer">1</span><span class="error">:</span><span class="integer">1</span>]~cljs.user=&gt; (js/console.dir x)
<span class="predefined-constant">nil</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="js-provider"><a class="anchor" href="#js-provider"></a><a class="link" href="#js-provider">13.1.2. パッケージプロバイダ</a></h4>
<div class="sidebarblock">
<div class="content">
<div class="title"><code>:shadow</code> vs <code>:closure</code></div>
<div class="paragraph">
<p>Ideally we want to use <code>:closure</code> as our primary JS Provider since that will run the entire application through <code>:advanced</code> giving us the most optimized output. In practice however lots of code available via <code>npm</code> is not compatible with the aggressive optimizations that <code>:advanced</code> compilation does. They either fail to compile at all or expose subtle bugs at runtime that are very hard to identify.</p>
</div>
<div class="paragraph">
<p><code>:shadow</code> is sort of a stopgap solution that only processes code via <code>:simple</code> and achieves much more reliable support while still getting reasonably optimized code. The output is comparable (or often better) to what other tools like <code>webpack</code> generate.</p>
</div>
<div class="paragraph">
<p>Until support in Closure gets more reliable <code>:shadow</code> is the recommend JS Provider for <code>:browser</code> builds.</p>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="symbol">:target</span> <span class="symbol">:browser</span>
   <span class="keyword">..</span><span class="keyword">.</span>
   <span class="symbol">:js-options</span> {<span class="symbol">:js-provider</span> <span class="symbol">:closure</span>}
   }}}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="js-entry-keys"><a class="anchor" href="#js-entry-keys"></a><a class="link" href="#js-entry-keys">13.1.3. CommonJS vs ESM</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="symbol">:target</span> <span class="symbol">:browser</span>
   <span class="keyword">..</span><span class="keyword">.</span>
   <span class="symbol">:js-options</span> {<span class="symbol">:entry-keys</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">module</span><span class="delimiter">&quot;</span></span> <span class="string"><span class="delimiter">&quot;</span><span class="content">browser</span><span class="delimiter">&quot;</span></span> <span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>]} <span class="comment">;; try &quot;module&quot; first</span>
   }}}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="js-resolve"><a class="anchor" href="#js-resolve"></a><a class="link" href="#js-resolve">13.1.4. パッケージを解決する</a></h4>
<div class="sect4">
<h5 id="js-resolve-global"><a class="anchor" href="#js-resolve-global"></a><a class="link" href="#js-resolve-global">CDNの利用</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="symbol">:target</span> <span class="symbol">:browser</span>
   <span class="keyword">..</span><span class="keyword">.</span>
   <span class="symbol">:js-options</span>
   {<span class="symbol">:resolve</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">react</span><span class="delimiter">&quot;</span></span> {<span class="symbol">:target</span> <span class="symbol">:global</span>
                       <span class="symbol">:global</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">React</span><span class="delimiter">&quot;</span></span>}}}}

  <span class="symbol">:server</span>
  {<span class="symbol">:target</span> <span class="symbol">:node-script</span>
   <span class="keyword">..</span><span class="keyword">.</span>}}}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="js-resolve-npm"><a class="anchor" href="#js-resolve-npm"></a><a class="link" href="#js-resolve-npm">require をリダイレクトする</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="symbol">:target</span> <span class="symbol">:browser</span>
   <span class="keyword">..</span><span class="keyword">.</span>
   <span class="symbol">:js-options</span>
   {<span class="symbol">:resolve</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">react</span><span class="delimiter">&quot;</span></span> {<span class="symbol">:target</span> <span class="symbol">:npm</span>
                       <span class="symbol">:require</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">preact-compat</span><span class="delimiter">&quot;</span></span>}}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="symbol">:target</span> <span class="symbol">:browser</span>
   <span class="keyword">..</span><span class="keyword">.</span>
   <span class="symbol">:js-options</span>
   {<span class="symbol">:resolve</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">react</span><span class="delimiter">&quot;</span></span> {<span class="symbol">:target</span> <span class="symbol">:file</span>
                       <span class="symbol">:file</span>   <span class="string"><span class="delimiter">&quot;</span><span class="content">src/main/override-react.js</span><span class="delimiter">&quot;</span></span>}}}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="js-resolve-limitations"><a class="anchor" href="#js-resolve-limitations"></a><a class="link" href="#js-resolve-limitations">制限事項</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="symbol">:target</span> <span class="symbol">:node-script</span>
   <span class="keyword">..</span><span class="keyword">.</span>
   <span class="symbol">:js-options</span>
   {<span class="symbol">:resolve</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">react</span><span class="delimiter">&quot;</span></span> {<span class="symbol">:target</span> <span class="symbol">:npm</span>
                       <span class="symbol">:require</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">preact-compat</span><span class="delimiter">&quot;</span></span>}}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">my.app</span>
  (<span class="symbol">:require</span>
    [<span class="string"><span class="delimiter">&quot;</span><span class="content">react-table</span><span class="delimiter">&quot;</span></span> <span class="symbol">:as</span> rt]))</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="alt-node-modules"><a class="anchor" href="#alt-node-modules"></a><a class="link" href="#alt-node-modules">13.1.5. 代替モジュールのディレクトリ</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:js-options</span> {<span class="symbol">:js-package-dirs</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">node_modules</span><span class="delimiter">&quot;</span></span> <span class="string"><span class="delimiter">&quot;</span><span class="content">../node_modules</span><span class="delimiter">&quot;</span></span>]}
 <span class="keyword">..</span><span class="keyword">.</span>}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="keyword">..</span><span class="keyword">.</span>
   <span class="symbol">:js-options</span> {<span class="symbol">:js-package-dirs</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">node_modules</span><span class="delimiter">&quot;</span></span> <span class="string"><span class="delimiter">&quot;</span><span class="content">../node_modules</span><span class="delimiter">&quot;</span></span>]}}}}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="classpath-js"><a class="anchor" href="#classpath-js"></a><a class="link" href="#classpath-js">13.2. .jsファイルへの対応</a></h3>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>DANGER: This feature is an experiment!</strong> It is currently only supported in <code>shadow-cljs</code> and other CLJS tools will yell at you if you attempt to use it. Use at your own risk. The feature was initially rejected from CLJS core but I think it is useful and should not have been <a href="https://dev.clojure.org/jira/browse/CLJS-2061?focusedCommentId=46191&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-46191">dismissed</a> without further discussion.</p>
</div>
<div class="paragraph">
<p>CLJS has an alternate <a href="https://clojurescript.org/guides/javascript-modules">implementation</a> which in turn is not supported by <code>shadow-cljs</code>. I found this implementation to be lacking in certain aspects so I opted for the different solution. Happy to discuss the pros/cons of both approaches though.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jsをrequrieする"><a class="anchor" href="#_jsをrequrieする"></a><a class="link" href="#_jsをrequrieする">13.2.1. JSをrequrieする</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">demo.app</span>
  (<span class="symbol">:require</span>
    [<span class="string"><span class="delimiter">&quot;</span><span class="content">/some-library/components/foo</span><span class="delimiter">&quot;</span></span> <span class="symbol">:as</span> foo]
    [<span class="string"><span class="delimiter">&quot;</span><span class="content">./bar</span><span class="delimiter">&quot;</span></span> <span class="symbol">:as</span> bar <span class="symbol">:refer</span> (myComponent)]))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">.
├── package.json
├── shadow-cljs.edn
└── src
    └── main
        └── demo
            └── app.cljs
    └── js
        └── demo
            └── bar.js</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_言語サポート"><a class="anchor" href="#_言語サポート"></a><a class="link" href="#_言語サポート">13.2.2. 言語サポート</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js"><span class="comment">// regular JS require</span>
<span class="reserved">import</span> Foo, { something } from <span class="string"><span class="delimiter">&quot;</span><span class="content">./other.js</span><span class="delimiter">&quot;</span></span>;

<span class="comment">// npm require</span>
<span class="reserved">import</span> React from <span class="string"><span class="delimiter">&quot;</span><span class="content">react</span><span class="delimiter">&quot;</span></span>;

<span class="comment">// require CLJS or Closure Library JS</span>
<span class="reserved">import</span> cljs from <span class="string"><span class="delimiter">&quot;</span><span class="content">goog:cljs.core</span><span class="delimiter">&quot;</span></span>;

<span class="reserved">export</span> <span class="keyword">function</span> <span class="function">inc</span>(num) {
  <span class="keyword">return</span> cljs.inc(<span class="integer">1</span>);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_javascriptの方言"><a class="anchor" href="#_javascriptの方言"></a><a class="link" href="#_javascriptの方言">13.2.3. JavaScriptの方言</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:source-paths</span>
 [<span class="string"><span class="delimiter">&quot;</span><span class="content">src/main</span><span class="delimiter">&quot;</span></span>
  <span class="string"><span class="delimiter">&quot;</span><span class="content">src/gen</span><span class="delimiter">&quot;</span></span>]
 <span class="keyword">..</span><span class="keyword">.</span>}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">.
├── package.json
├── shadow-cljs.edn
└── src
    └── main
        └── demo
            └── app.cljs
    └── js
        ├── .babelrc
        └── demo
            └── bar.jsx</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/js/demo/bar.jsx</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="jsx">import React from &quot;react&quot;;

function myComponent() {
  return &lt;h1&gt;JSX!&lt;/h1&gt;;
}

export { myComponent };</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ babel src/js --out-dir src/gen
# or during development
$ babel src/js --out-dir src/gen --watch</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">plugins</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">transform-react-jsx</span><span class="delimiter">&quot;</span></span>]
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jsからcljsへのアクセス"><a class="anchor" href="#_jsからcljsへのアクセス"></a><a class="link" href="#_jsからcljsへのアクセス">13.2.4. JSからCLJSへのアクセス</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">import</span> cljs, { <span class="keyword">keyword</span> } from <span class="string"><span class="delimiter">&quot;</span><span class="content">goog:cljs.core</span><span class="delimiter">&quot;</span></span><span class="comment">;</span>

// construct {<span class="symbol">:foo</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">hello world</span><span class="delimiter">&quot;</span></span>} in JS
cljs.array_map(<span class="keyword">keyword</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">hello world</span><span class="delimiter">&quot;</span></span>)<span class="comment">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cljsjs"><a class="anchor" href="#cljsjs"></a><a class="link" href="#cljsjs">13.3. cljsjs.* の移行について</a></h3>
<div class="paragraph">
<p>Migrating cljsjs.* <a id="cljsjs"></a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">cljsjs.react</span>
  (<span class="symbol">:require</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">react</span><span class="delimiter">&quot;</span></span> <span class="symbol">:as</span> react]
            [<span class="string"><span class="delimiter">&quot;</span><span class="content">create-react-class</span><span class="delimiter">&quot;</span></span> <span class="symbol">:as</span> crc]))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(js/goog.object.set react <span class="string"><span class="delimiter">&quot;</span><span class="content">createClass</span><span class="delimiter">&quot;</span></span> crc)
(js/goog.exportSymbol <span class="string"><span class="delimiter">&quot;</span><span class="content">React</span><span class="delimiter">&quot;</span></span> react)</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_cljsjsを使ってみませんか"><a class="anchor" href="#_cljsjsを使ってみませんか"></a><a class="link" href="#_cljsjsを使ってみませんか">13.3.1. CLJSJSを使ってみませんか?</a></h4>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="release"><a class="anchor" href="#release"></a><a class="link" href="#release">14. プロダクションコードの生成&#8201;&#8212;&#8201;全ターゲット</a></h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">$ shadow-cljs release build-id</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_リリースの構成"><a class="anchor" href="#_リリースの構成"></a><a class="link" href="#_リリースの構成">14.1. リリースの構成</a></h3>
<div class="sect3">
<h4 id="Optimization"><a class="anchor" href="#Optimization"></a><a class="link" href="#Optimization">14.1.1. 最適化</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:build</span>
   {<span class="symbol">:build-id</span>
     {<span class="keyword">..</span><span class="keyword">.</span>
      <span class="symbol">:compiler-options</span> {<span class="symbol">:optimizations</span> <span class="symbol">:simple</span>}}}}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_release_に特異_vs_開発環境"><a class="anchor" href="#_release_に特異_vs_開発環境"></a><a class="link" href="#_release_に特異_vs_開発環境">14.1.2. release に特異 vs 開発環境</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:source-paths</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">src</span><span class="delimiter">&quot;</span></span>]
 <span class="symbol">:dependencies</span> []
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="symbol">:target</span> <span class="symbol">:browser</span>
   <span class="symbol">:output-dir</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">public/js</span><span class="delimiter">&quot;</span></span>
   <span class="symbol">:asset-path</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/js</span><span class="delimiter">&quot;</span></span>
   <span class="symbol">:modules</span> {<span class="symbol">:base</span> {<span class="symbol">:entries</span> [my.app.core]}}

   <span class="comment">;; Here is some dev-specific config</span>
   <span class="symbol">:dev</span> {<span class="symbol">:compiler-options</span> {<span class="symbol">:devcards</span> <span class="predefined-constant">true</span>}}

   <span class="comment">;; Here is some production config</span>
   <span class="symbol">:release</span> {<span class="symbol">:compiler-options</span> {<span class="symbol">:optimizations</span> <span class="symbol">:simple</span>}}}}}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="externs"><a class="anchor" href="#externs"></a><a class="link" href="#externs">14.2. エクスターン</a></h3>
<div class="sect3">
<h4 id="infer-externs"><a class="anchor" href="#infer-externs"></a><a class="link" href="#infer-externs">14.2.1. エクスターンズの推論</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="symbol">:target</span> <span class="symbol">:browser</span>
   <span class="keyword">..</span><span class="keyword">.</span>
   <span class="symbol">:compiler-options</span> {<span class="symbol">:infer-externs</span> <span class="symbol">:auto</span>}
   }}}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">defn</span> <span class="function">wrap-baz</span> [x]
  (<span class="keyword">.</span>baz x))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Warning</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">------ WARNING #1 --------------------------------------------------------------
 File: ~/project/src/demo/thing.cljs:23:3
--------------------------------------------------------------------------------
  21 |
  22 | (defn wrap-baz [x]
  23 |   (.baz x))
---------^----------------------------------------------------------------------
 Cannot infer target type in expression (. x baz)
--------------------------------------------------------------------------------</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">defn</span> <span class="function">wrap-baz</span> [x]
  (<span class="keyword">.</span>baz ^js x))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">defn</span> <span class="function">wrap-baz</span> [x]
  (<span class="keyword">.</span>foo ^js x)
  (<span class="keyword">.</span>baz ^js x))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">defn</span> <span class="function">wrap-baz</span> [^js x]
  (<span class="keyword">.</span>foo x)
  (<span class="keyword">.</span>baz x))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(js/Some.Thing.coolFunction)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">ns</span> <span class="namespace">my.app</span>
  (<span class="symbol">:require</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">react</span><span class="delimiter">&quot;</span></span> <span class="symbol">:as</span> react <span class="symbol">:refer</span> (createElement)]))

(react/createElement <span class="string"><span class="delimiter">&quot;</span><span class="content">div</span><span class="delimiter">&quot;</span></span> <span class="predefined-constant">nil</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">hello world</span><span class="delimiter">&quot;</span></span>)
(createElement <span class="string"><span class="delimiter">&quot;</span><span class="content">div</span><span class="delimiter">&quot;</span></span> <span class="predefined-constant">nil</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">hello world</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_マニュアルのエクスターン"><a class="anchor" href="#_マニュアルのエクスターン"></a><a class="link" href="#_マニュアルのエクスターン">14.2.2. マニュアルのエクスターン</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="symbol">:target</span> <span class="symbol">:browser</span>
   <span class="keyword">..</span><span class="keyword">.</span>
   <span class="symbol">:compiler-options</span> {<span class="symbol">:externs</span> [<span class="string"><span class="delimiter">&quot;</span><span class="content">path/to/externs.js</span><span class="delimiter">&quot;</span></span> <span class="keyword">..</span><span class="keyword">.</span>]}
   }}}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_簡易なエクスターン"><a class="anchor" href="#_簡易なエクスターン"></a><a class="link" href="#_簡易なエクスターン">14.2.3. 簡易なエクスターン</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="error">#</span> this is a <span class="keyword">comment</span>
foo
bar
global<span class="symbol">:SomeGlobalVariable</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_コード_ストリッピング"><a class="anchor" href="#_コード_ストリッピング"></a><a class="link" href="#_コード_ストリッピング">14.3. コード・ストリッピング</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="keyword">..</span><span class="keyword">.</span>
 <span class="symbol">:builds</span>
 {<span class="symbol">:app</span>
  {<span class="symbol">:target</span> <span class="symbol">:browser</span>
   <span class="keyword">..</span><span class="keyword">.</span>
   <span class="symbol">:compiler-options</span> {<span class="symbol">:strip-type-prefixes</span> #{<span class="string"><span class="delimiter">&quot;</span><span class="content">cljs.pprint</span><span class="delimiter">&quot;</span></span>}
   }}}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="build-report"><a class="anchor" href="#build-report"></a><a class="link" href="#build-report">14.4. ビルドレポート</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ npx shadow-cljs run shadow.cljs.build-report &lt;build-id&gt; &lt;path/to/output.html&gt;
# example
$ npx shadow-cljs run shadow.cljs.build-report app report.html</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_エディタの統合"><a class="anchor" href="#_エディタの統合"></a><a class="link" href="#_エディタの統合">15. エディタの統合</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_cursive"><a class="anchor" href="#_cursive"></a><a class="link" href="#_cursive">15.1. Cursive</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">$ shadow-cljs pom</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(defproject your/project <span class="string"><span class="delimiter">&quot;</span><span class="content">0.0.0</span><span class="delimiter">&quot;</span></span>
  <span class="symbol">:dependencies</span>
  [[thheller/shadow-cljs <span class="string"><span class="delimiter">&quot;</span><span class="content">X.Y.Z</span><span class="delimiter">&quot;</span></span>]]

  <span class="symbol">:source-paths</span>
  [<span class="string"><span class="delimiter">&quot;</span><span class="content">src</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cider"><a class="anchor" href="#cider"></a><a class="link" href="#cider">15.2. Emacs / CIDER</a></h3>
<div class="sect3">
<h4 id="_clojurescript_replの起動"><a class="anchor" href="#_clojurescript_replの起動"></a><a class="link" href="#_clojurescript_replの起動">15.2.1. ClojureScript REPLの起動</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">M-x cider-jack-in-cljs</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">Select ClojureScript REPL type:</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">Select shadow-cljs build:</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">shadow.user&gt; To quit, type: :cljs/quit
[:selected :app]
cljs.repl&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">cljs.repl&gt; (js/alert &quot;Jurassic Park!&quot;)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dir_localによるスタートアップの簡素化"><a class="anchor" href="#_dir_localによるスタートアップの簡素化"></a><a class="link" href="#_dir_localによるスタートアップの簡素化">15.2.2. dir-localによるスタートアップの簡素化</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">((<span class="predefined-constant">nil</span> <span class="keyword">.</span> ((cider-default-cljs-repl <span class="keyword">.</span> shadow)
         (cider-shadow-default-options <span class="keyword">.</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;your-build-name-here&gt;</span><span class="delimiter">&quot;</span></span>))))</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_proto_repl_atom"><a class="anchor" href="#_proto_repl_atom"></a><a class="link" href="#_proto_repl_atom">15.3. Proto REPL (Atom)</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"> (<span class="keyword">ns</span> <span class="namespace">user</span>)

 (<span class="keyword">defn</span> <span class="function">reset</span> [])</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_chlorine_atom"><a class="anchor" href="#_chlorine_atom"></a><a class="link" href="#_chlorine_atom">15.4. Chlorine (Atom)</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">$ shadow-cljs watch app</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_calva_vs_code"><a class="anchor" href="#_calva_vs_code"></a><a class="link" href="#_calva_vs_code">15.5. Calva (VS Code)</a></h3>
<div class="sect3">
<h4 id="_依存関係_2"><a class="anchor" href="#_依存関係_2"></a><a class="link" href="#_依存関係_2">15.5.1. 依存関係</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">[cider/cider-nrepl <span class="string"><span class="delimiter">&quot;</span><span class="content">0.21.0</span><span class="delimiter">&quot;</span></span>]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_calvaとreplの接続"><a class="anchor" href="#_calvaとreplの接続"></a><a class="link" href="#_calvaとreplの接続">15.5.2. CalvaとREPLの接続</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">$ shadow-cljs watch app</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_特徴"><a class="anchor" href="#_特徴"></a><a class="link" href="#_特徴">15.5.3. 特徴</a></h4>
<div class="sect4">
<h5 id="_intellisense_など"><a class="anchor" href="#_intellisense_など"></a><a class="link" href="#_intellisense_など">Intellisense など</a></h5>

</div>
<div class="sect4">
<h5 id="_ファイル_フォーム_セレクションの評価"><a class="anchor" href="#_ファイル_フォーム_セレクションの評価"></a><a class="link" href="#_ファイル_フォーム_セレクションの評価">ファイル、フォーム、セレクションの評価</a></h5>

</div>
<div class="sect4">
<h5 id="_テストの実行"><a class="anchor" href="#_テストの実行"></a><a class="link" href="#_テストの実行">テストの実行</a></h5>

</div>
<div class="sect4">
<h5 id="_ターミナルの_repl"><a class="anchor" href="#_ターミナルの_repl"></a><a class="link" href="#_ターミナルの_repl">ターミナルの REPL</a></h5>

</div>
<div class="sect4">
<h5 id="_cljc_のファイル群"><a class="anchor" href="#_cljc_のファイル群"></a><a class="link" href="#_cljc_のファイル群">Cljc のファイル群</a></h5>

</div>
</div>
</div>
<div class="sect2">
<h3 id="_fireplace_vim_vim_neovim"><a class="anchor" href="#_fireplace_vim_vim_neovim"></a><a class="link" href="#_fireplace_vim_vim_neovim">15.6. Fireplace.vim (Vim/Neovim)</a></h3>
<div class="sect3">
<h4 id="_依存関係_3"><a class="anchor" href="#_依存関係_3"></a><a class="link" href="#_依存関係_3">15.6.1. 依存関係</a></h4>

</div>
<div class="sect3">
<h4 id="_アプリの準備"><a class="anchor" href="#_アプリの準備"></a><a class="link" href="#_アプリの準備">15.6.2. アプリの準備</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="comment">;; shadow-cljs configuration</span>
{<span class="symbol">:source-paths</span>
 [<span class="string"><span class="delimiter">&quot;</span><span class="content">src/dev</span><span class="delimiter">&quot;</span></span>
  <span class="string"><span class="delimiter">&quot;</span><span class="content">src/main</span><span class="delimiter">&quot;</span></span>
  <span class="string"><span class="delimiter">&quot;</span><span class="content">src/test</span><span class="delimiter">&quot;</span></span>]

 <span class="comment">;; ADD - CIDER-nREPL middleware required by Fireplace.vim</span>
 <span class="symbol">:dependencies</span>
 [[cider/cider-nrepl <span class="string"><span class="delimiter">&quot;</span><span class="content">0.22.4</span><span class="delimiter">&quot;</span></span>]]

 <span class="comment">;; ADD - a port (e.g., 3333) for the REPL server to which Fireplace.vim connects</span>
 <span class="symbol">:nrepl</span>
 {<span class="symbol">:port</span> <span class="integer">3333</span>}

 <span class="comment">;; ADD - a port (e.g., 8080) for the development-time HTTP server that serves the app</span>
 <span class="symbol">:dev-http</span>
 {<span class="integer">8080</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">public</span><span class="delimiter">&quot;</span></span>}

 <span class="symbol">:builds</span>
 {<span class="symbol">:frontend</span>  <span class="comment">; NOTE - This is the build ID referenced at various places below.</span>
  {<span class="symbol">:target</span> <span class="symbol">:browser</span>
   <span class="symbol">:modules</span> {<span class="symbol">:main</span> {<span class="symbol">:init-fn</span> acme.frontend.app/init}}}}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">npx shadow-cljs watch frontend</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">No application has connected to the REPL server.
Make sure your JS environment has loaded your compiled ClojureScript code.</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fireplace_vimとreplサーバーの接続"><a class="anchor" href="#_fireplace_vimとreplサーバーの接続"></a><a class="link" href="#_fireplace_vimとreplサーバーの接続">15.6.3. Fireplace.vimとREPLサーバーの接続</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="symbol">:Connect</span> <span class="integer">3333</span>
=&gt;
Connected to nrepl<span class="symbol">://localhost</span><span class="error">:</span><span class="integer">3333</span><span class="keyword">/</span>
Scope connection to<span class="error">:</span> ~/code/clojurescript/acme-app (ENTER)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="symbol">:CljEval</span> (shadow/repl <span class="symbol">:frontend</span>)
=&gt;
To quit, <span class="keyword">type</span><span class="error">:</span> <span class="symbol">:cljs/quit</span>
[<span class="symbol">:selected</span> <span class="symbol">:frontend</span>]
Press ENTER <span class="keyword">or</span> <span class="keyword">type</span> command to continue</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_トラブルシューティング"><a class="anchor" href="#_トラブルシューティング"></a><a class="link" href="#_トラブルシューティング">16. トラブルシューティング</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="failed-to-load"><a class="anchor" href="#failed-to-load"></a><a class="link" href="#failed-to-load">16.1. 起動時のエラー</a></h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://clojars.org/thheller/shadow-cljs" class="bare">https://clojars.org/thheller/shadow-cljs</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_deps_edn_tools_deps"><a class="anchor" href="#_deps_edn_tools_deps"></a><a class="link" href="#_deps_edn_tools_deps">16.1.1. deps.edn / tools.deps</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ clj -A:dev:cljs -Stree</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_project_clj_leiningen"><a class="anchor" href="#_project_clj_leiningen"></a><a class="link" href="#_project_clj_leiningen">16.1.2. project.clj / Leiningen</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="error">#</span> no profile
$ lein deps <span class="symbol">:tree</span>

<span class="error">#</span> with profile
$ lein with-profiles +cljs deps <span class="symbol">:tree</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repl-troubleshooting"><a class="anchor" href="#repl-troubleshooting"></a><a class="link" href="#repl-troubleshooting">16.2. REPL</a></h3>
<div class="imageblock">
<div class="content">
<img src="assets/img/shadow-cljs-repl.png" alt="shadow cljs repl">
</div>
</div>
<div class="sect3">
<h4 id="cljs-repl-anatomy"><a class="anchor" href="#cljs-repl-anatomy"></a><a class="link" href="#cljs-repl-anatomy">16.2.1. CLJS REPLの分析</a></h4>

</div>
<div class="sect3">
<h4 id="_javascript_のランタイム"><a class="anchor" href="#_javascript_のランタイム"></a><a class="link" href="#_javascript_のランタイム">16.2.2. JavaScript のランタイム</a></h4>

</div>
<div class="sect3">
<h4 id="missing-js-runtime"><a class="anchor" href="#missing-js-runtime"></a><a class="link" href="#missing-js-runtime">16.2.3. Missing JS runtime</a></h4>
<div class="sect4">
<h5 id="repl-trouble-browser"><a class="anchor" href="#repl-trouble-browser"></a><a class="link" href="#repl-trouble-browser">:target :browser</a></h5>

</div>
<div class="sect4">
<h5 id="repl-trouble-node"><a class="anchor" href="#repl-trouble-node"></a><a class="link" href="#repl-trouble-node">:target :node-script, :node-library</a></h5>

</div>
<div class="sect4">
<h5 id="repl-trouble-react-native"><a class="anchor" href="#repl-trouble-react-native"></a><a class="link" href="#repl-trouble-react-native">:target :react-native</a></h5>

</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="publish"><a class="anchor" href="#publish"></a><a class="link" href="#publish">17. ライブラリの publish</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="publish-lein"><a class="anchor" href="#publish-lein"></a><a class="link" href="#publish-lein">17.1. Leiningen</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(defproject your.cool/library <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0.0</span><span class="delimiter">&quot;</span></span>
  <span class="symbol">:description</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Does cool stuff</span><span class="delimiter">&quot;</span></span>
  <span class="symbol">:url</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">https://the.inter.net/wherever</span><span class="delimiter">&quot;</span></span>

  <span class="comment">;; this is optional, add what you want or remove it</span>
  <span class="symbol">:license</span> {<span class="symbol">:name</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Eclipse Public License</span><span class="delimiter">&quot;</span></span>
            <span class="symbol">:url</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.eclipse.org/legal/epl-v10.html</span><span class="delimiter">&quot;</span></span>}

  <span class="symbol">:dependencies</span>
  <span class="comment">;; always use &quot;provided&quot; for Clojure(Script)</span>
  [[org.clojure/clojurescript <span class="string"><span class="delimiter">&quot;</span><span class="content">1.10.520</span><span class="delimiter">&quot;</span></span> <span class="symbol">:scope</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">provided</span><span class="delimiter">&quot;</span></span>]
   [some.other/library <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0.0</span><span class="delimiter">&quot;</span></span>]

  <span class="symbol">:source-paths</span>
  [<span class="string"><span class="delimiter">&quot;</span><span class="content">src/main</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_jar署名の無効化"><a class="anchor" href="#_jar署名の無効化"></a><a class="link" href="#_jar署名の無効化">17.1.1. JAR署名の無効化</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(defproject your.cool/library <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0.0</span><span class="delimiter">&quot;</span></span>
  <span class="keyword">..</span><span class="keyword">.</span>
  <span class="symbol">:repositories</span>
  {<span class="string"><span class="delimiter">&quot;</span><span class="content">clojars</span><span class="delimiter">&quot;</span></span> {<span class="symbol">:url</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">https://clojars.org/repo</span><span class="delimiter">&quot;</span></span>
              <span class="symbol">:sign-releases</span> <span class="predefined-constant">false</span>}}
  <span class="keyword">..</span><span class="keyword">.</span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jarをクリーンに保つ"><a class="anchor" href="#_jarをクリーンに保つ"></a><a class="link" href="#_jarをクリーンに保つ">17.1.2. JARをクリーンに保つ</a></h4>

</div>
</div>
<div class="sect2">
<h3 id="publish-deps-cljs"><a class="anchor" href="#publish-deps-cljs"></a><a class="link" href="#publish-deps-cljs">17.2. JSの依存関係を宣言する</a></h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">{<span class="symbol">:npm-deps</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">the-thing</span><span class="delimiter">&quot;</span></span> <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0.0</span><span class="delimiter">&quot;</span></span>}}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_上手くいかない場合はどうすればいいか"><a class="anchor" href="#_上手くいかない場合はどうすればいいか"></a><a class="link" href="#_上手くいかない場合はどうすればいいか">18. 上手くいかない場合はどうすればいいか</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>JSの世界は今でも急速に進化しており、誰もが同じ方法でコードを書いたり配布したりしているわけではありません。
shadow-cljs`では自動的に回避できないものがあります。これらは
通常はカスタムの <code>:resolve</code> 設定で解決できますが、バグや見落としもあるかもしれません。</p>
</div>
<div class="paragraph">
<p>この章の説明で解決できない場合は、次のような場所で質問してみてください。
<a href="https://clojurians.slack.com/messages/C6N245JGG"><code>#shadow-cljs</code> Slackチャンネル</a>で聞いてみてください。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hacking"><a class="anchor" href="#_hacking"></a><a class="link" href="#_hacking">19. Hacking</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ライブラリーのパッチ適用"><a class="anchor" href="#_ライブラリーのパッチ適用"></a><a class="link" href="#_ライブラリーのパッチ適用">19.1. ライブラリーのパッチ適用</a></h3>
<div class="paragraph">
<p>shadow-cljs`コンパイラは、あなたのソースパス上にあるものが最初にコンパイルされるようにし、JARからのファイルを優先します。つまり、ライブラリからソースファイルをコピーしてパッチを当て、それを自分のソースディレクトリにインクルードすることができるのです。</p>
</div>
<div class="paragraph">
<p>これは、そのプロジェクトをクローンして、そのセットアップやビルドなどを理解しなくても、修正（`shadow-cljs`自体も！）をテストするための便利な方法です。
プロジェクトをクローンして、そのセットアップやビルドなどを理解することなく、修正をテストする便利な方法です。</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0<br>
Last updated 2021-04-05 21:51:07 JST
</div>
</div>
</body>
</html>